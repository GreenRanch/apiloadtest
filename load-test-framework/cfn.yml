Parameters:
  apiGatewayUrl:
    Type: String
    Description: API Gateway URL being load tested.
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D:
    Type: String
    Description: S3 bucket for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962:
    Type: String
    Description: S3 key for asset version "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcArtifactHash4AD90612:
    Type: String
    Description: Artifact hash for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dS3Bucket750B891F:
    Type: String
    Description: S3 bucket for asset "48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87d"
  AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dS3VersionKeyA95D11C4:
    Type: String
    Description: S3 key for asset version "48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87d"
  AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dArtifactHash754521D3:
    Type: String
    Description: Artifact hash for asset "48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87d"
  AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3Bucket65C283B5:
    Type: String
    Description: S3 bucket for asset "a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8"
  AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3VersionKey75DFE7A2:
    Type: String
    Description: S3 key for asset version "a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8"
  AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8ArtifactHash3426DA5A:
    Type: String
    Description: Artifact hash for asset "a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8"
  AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3BucketC1014CE1:
    Type: String
    Description: S3 bucket for asset "9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11"
  AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3VersionKeyFF04957D:
    Type: String
    Description: S3 key for asset version "9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11"
  AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11ArtifactHashEB517A0F:
    Type: String
    Description: Artifact hash for asset "9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11"
  AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3BucketB9F5835B:
    Type: String
    Description: S3 bucket for asset "dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c"
  AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3VersionKeyD80B12BA:
    Type: String
    Description: S3 key for asset version "dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c"
  AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cArtifactHash8FEBF4B9:
    Type: String
    Description: Artifact hash for asset "dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c"
  AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3Bucket1F5C3F3C:
    Type: String
    Description: S3 bucket for asset "adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7"
  AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3VersionKey042EF73F:
    Type: String
    Description: S3 key for asset version "adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7"
  AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7ArtifactHashAF439838:
    Type: String
    Description: Artifact hash for asset "adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7"
  AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3BucketA1CDCDEA:
    Type: String
    Description: S3 bucket for asset "956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6"
  AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3VersionKey75D08C82:
    Type: String
    Description: S3 key for asset version "956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6"
  AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6ArtifactHash04DC176F:
    Type: String
    Description: Artifact hash for asset "956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6"
Resources:
  customEmailSenderServiceRoleBF40400B:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/customEmailSender/ServiceRole/Resource
  customEmailSender8DB4CFA9:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
      Role:
        Fn::GetAtt:
          - customEmailSenderServiceRoleBF40400B
          - Arn
      Handler: index.handler
      Runtime: nodejs12.x
    DependsOn:
      - customEmailSenderServiceRoleBF40400B
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/customEmailSender/Resource
      aws:asset:path: asset.016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc
      aws:asset:property: Code
  customEmailSenderInvokeServicePrincipalcognitoidpamazonawscomF4DDC689:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - customEmailSender8DB4CFA9
          - Arn
      Principal: cognito-idp.amazonaws.com
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/customEmailSender/InvokeServicePrincipal(cognito-idp.amazonaws.com)
  ApiLoadTestCustomEmailSenderKeyA6F61AB3:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action:
              - kms:Create*
              - kms:Describe*
              - kms:Enable*
              - kms:List*
              - kms:Put*
              - kms:Update*
              - kms:Revoke*
              - kms:Disable*
              - kms:Get*
              - kms:Delete*
              - kms:ScheduleKeyDeletion
              - kms:CancelKeyDeletion
              - kms:GenerateDataKey
              - kms:TagResource
              - kms:UntagResource
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
        Version: "2012-10-17"
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_CustomEmailSenderKey/Resource
  ApiLoadTestcognitoUserPoolD1C7B603:
    Type: AWS::Cognito::UserPool
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
          - Name: verified_phone_number
            Priority: 1
          - Name: verified_email
            Priority: 2
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: true
      EmailVerificationMessage: The verification code to your new account is {####}
      EmailVerificationSubject: Verify your new account
      SmsVerificationMessage: The verification code to your new account is {####}
      UserPoolName: loadtestidp
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: The verification code to your new account is {####}
        EmailSubject: Verify your new account
        SmsMessage: The verification code to your new account is {####}
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_cognitoUserPool/Resource
  ApiLoadTestcognitoUserPooltestusers19717B82:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      UserPoolId:
        Ref: ApiLoadTestcognitoUserPoolD1C7B603
      AllowedOAuthFlows:
        - implicit
        - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
        - profile
        - phone
        - email
        - openid
        - aws.cognito.signin.user.admin
      CallbackURLs:
        - https://example.com
      SupportedIdentityProviders:
        - COGNITO
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_cognitoUserPool/testusers/Resource
  ApiLoadTestcreateTestUserIdsServiceRoleDD73FF11:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_createTestUserIds/ServiceRole/Resource
  ApiLoadTestcreateTestUserIdsF6C72052:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dS3Bucket750B891F
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dS3VersionKeyA95D11C4
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dS3VersionKeyA95D11C4
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserIdsServiceRoleDD73FF11
          - Arn
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 3
    DependsOn:
      - ApiLoadTestcreateTestUserIdsServiceRoleDD73FF11
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_createTestUserIds/Resource
      aws:asset:path: asset.48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87d
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUsersServiceRole42D7568C:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_cleanUpTestUsers/ServiceRole/Resource
  ApiLoadTestcleanUpTestUsersB2FB4E74:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3Bucket65C283B5
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3VersionKey75DFE7A2
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3VersionKey75DFE7A2
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUsersServiceRole42D7568C
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers19717B82
          userpool_id:
            Ref: ApiLoadTestcognitoUserPoolD1C7B603
      Handler: lambda_function.lambda_handler
      MemorySize: 512
      Runtime: python3.8
      Timeout: 600
    DependsOn:
      - ApiLoadTestcleanUpTestUsersServiceRole42D7568C
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_cleanUpTestUsers/Resource
      aws:asset:path: asset.a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8
      aws:asset:property: Code
  ApiLoadTestcreateTestUsersServiceRole5407F30A:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_createTestUsers/ServiceRole/Resource
  ApiLoadTestcreateTestUsers3AA46DEC:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3BucketC1014CE1
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3VersionKeyFF04957D
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3VersionKeyFF04957D
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUsersServiceRole5407F30A
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers19717B82
          userpool_id:
            Ref: ApiLoadTestcognitoUserPoolD1C7B603
      Handler: lambda_function.lambda_handler
      MemorySize: 856
      Runtime: python3.8
      Timeout: 900
    DependsOn:
      - ApiLoadTestcreateTestUsersServiceRole5407F30A
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_createTestUsers/Resource
      aws:asset:path: asset.9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11
      aws:asset:property: Code
  ApiLoadTesttriggerLoadTestPerUserServiceRole458340FB:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_triggerLoadTestPerUser/ServiceRole/Resource
  ApiLoadTesttriggerLoadTestPerUserB4B87E2F:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3BucketB9F5835B
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3VersionKeyD80B12BA
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3VersionKeyD80B12BA
      Role:
        Fn::GetAtt:
          - ApiLoadTesttriggerLoadTestPerUserServiceRole458340FB
          - Arn
      Environment:
        Variables:
          numberOfCallsPerUser: $.NumberOfCallsPerUser
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers19717B82
          userpool_id:
            Ref: ApiLoadTestcognitoUserPoolD1C7B603
          api_url:
            Ref: apiGatewayUrl
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Runtime: python3.8
      Timeout: 300
    DependsOn:
      - ApiLoadTesttriggerLoadTestPerUserServiceRole458340FB
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_triggerLoadTestPerUser/Resource
      aws:asset:path: asset.dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUserServiceRoleDE3D142A:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_cleanUpTestUser/ServiceRole/Resource
  ApiLoadTestcleanUpTestUser6937474C:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3Bucket1F5C3F3C
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3VersionKey042EF73F
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3VersionKey042EF73F
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUserServiceRoleDE3D142A
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers19717B82
          userpool_id:
            Ref: ApiLoadTestcognitoUserPoolD1C7B603
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcleanUpTestUserServiceRoleDE3D142A
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_cleanUpTestUser/Resource
      aws:asset:path: asset.adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7
      aws:asset:property: Code
  ApiLoadTestcreateTestUserServiceRoleAB8EF89C:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_createTestUser/ServiceRole/Resource
  ApiLoadTestcreateTestUserE27DD705:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3BucketA1CDCDEA
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3VersionKey75D08C82
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3VersionKey75D08C82
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserServiceRoleAB8EF89C
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers19717B82
          userpool_id:
            Ref: ApiLoadTestcognitoUserPoolD1C7B603
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcreateTestUserServiceRoleAB8EF89C
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_createTestUser/Resource
      aws:asset:path: asset.956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6
      aws:asset:property: Code
  ApiLoadTestCreateUsersAndFanOutRoleCFEBDBC2:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_CreateUsersAndFanOut/Role/Resource
  ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyE06FF8B4:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUserIdsF6C72052
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUsers3AA46DEC
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUserB4B87E2F
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyE06FF8B4
      Roles:
        - Ref: ApiLoadTestCreateUsersAndFanOutRoleCFEBDBC2
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_CreateUsersAndFanOut/Role/DefaultPolicy/Resource
  ApiLoadTestCreateUsersAndFanOut8FCDDC29:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestCreateUsersAndFanOutRoleCFEBDBC2
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"Is Input Valid?","States":{"Is Input Valid?":{"Type":"Choice","Choices":[{"Variable":"$.NumberOfUsers","NumericGreaterThan":1000,"Next":"Input validation failed: NumberOfUsers"},{"Variable":"$.NumberOfCallsPerUser","NumericGreaterThan":1000,"Next":"Input validation failed: NumberOfCallsPerUser"}],"Default":"CreateTestUserIdsTask"},"CreateTestUserIdsTask":{"Next":"CreateTestUsersTask","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","OutputPath":"$.taskResult","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUserIdsF6C72052
                - Arn
            - '","Payload.$":"$"}},"CreateTestUsersTask":{"Next":"TriggerLoadTest","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUsers3AA46DEC
                - Arn
            - '","Payload.$":"$"}},"TriggerLoadTest":{"Type":"Map","Next":"Complete","Iterator":{"StartAt":"TriggerLoadTestPerUserTask","States":{"TriggerLoadTestPerUserTask":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUserB4B87E2F
                - Arn
            - '","Payload.$":"$"}}}},"ItemsPath":"$.taskResult.userNames","MaxConcurrency":0},"Complete":{"Type":"Pass","End":true},"Input validation failed: NumberOfUsers":{"Type":"Fail","Error":"NumberOfUsers > 1000","Cause":"Input Validation Failed. Please check NumberOfUser"},"Input validation failed: NumberOfCallsPerUser":{"Type":"Fail","Error":"NumberOfCallsPerUser > 1000 ","Cause":"Input Validation Failed. Please check NumberOfCallsPerUser. "}},"TimeoutSeconds":900}'
    DependsOn:
      - ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyE06FF8B4
      - ApiLoadTestCreateUsersAndFanOutRoleCFEBDBC2
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_CreateUsersAndFanOut/Resource
  ApiLoadTestDeleteTestUsersRole88CA5F3E:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_DeleteTestUsers/Role/Resource
  ApiLoadTestDeleteTestUsersRoleDefaultPolicy26B3C412:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsersB2FB4E74
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestDeleteTestUsersRoleDefaultPolicy26B3C412
      Roles:
        - Ref: ApiLoadTestDeleteTestUsersRole88CA5F3E
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_DeleteTestUsers/Role/DefaultPolicy/Resource
  ApiLoadTestDeleteTestUsers80BE174E:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestDeleteTestUsersRole88CA5F3E
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"DeleteTestUsersTask","States":{"DeleteTestUsersTask":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsersB2FB4E74
                - Arn
            - '","Payload.$":"$"}}},"TimeoutSeconds":600}'
    DependsOn:
      - ApiLoadTestDeleteTestUsersRoleDefaultPolicy26B3C412
      - ApiLoadTestDeleteTestUsersRole88CA5F3E
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/ApiLoadTest_DeleteTestUsers/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=1.87.1,@aws-cdk/assets=1.89.0,@aws-cdk/aws-applicationautoscaling=1.89.0,@aws-cdk/aws-autoscaling=1.89.0,@aws-cdk/aws-autoscaling-common=1.89.0,@aws-cdk/aws-autoscaling-hooktargets=1.89.0,@aws-cdk/aws-cloudwatch=1.89.0,@aws-cdk/aws-codebuild=1.89.0,@aws-cdk/aws-codeguruprofiler=1.89.0,@aws-cdk/aws-cognito=1.89.0,@aws-cdk/aws-ec2=1.89.0,@aws-cdk/aws-ecr=1.89.0,@aws-cdk/aws-ecr-assets=1.89.0,@aws-cdk/aws-ecs=1.89.0,@aws-cdk/aws-elasticloadbalancingv2=1.89.0,@aws-cdk/aws-events=1.89.0,@aws-cdk/aws-iam=1.89.0,@aws-cdk/aws-kms=1.89.0,@aws-cdk/aws-lambda=1.89.0,@aws-cdk/aws-logs=1.89.0,@aws-cdk/aws-s3=1.89.0,@aws-cdk/aws-s3-assets=1.89.0,@aws-cdk/aws-servicediscovery=1.89.0,@aws-cdk/aws-sns=1.89.0,@aws-cdk/aws-sns-subscriptions=1.89.0,@aws-cdk/aws-sqs=1.89.0,@aws-cdk/aws-ssm=1.89.0,@aws-cdk/aws-stepfunctions=1.89.0,@aws-cdk/aws-stepfunctions-tasks=1.89.0,@aws-cdk/cloud-assembly-schema=1.89.0,@aws-cdk/core=1.89.0,@aws-cdk/custom-resources=1.89.0,@aws-cdk/cx-api=1.89.0,@aws-cdk/region-info=1.89.0,jsii-runtime=node.js/v10.23.2
    Metadata:
      aws:cdk:path: aws-stepfunctions-integ/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Outputs:
  UserPoolID:
    Description: User Pool ID
    Value:
      Ref: ApiLoadTestcognitoUserPoolD1C7B603
    Export:
      Name: UserPoolID
  KMSKey:
    Description: CustomEmailSender KMS Key ARN
    Value:
      Fn::GetAtt:
        - ApiLoadTestCustomEmailSenderKeyA6F61AB3
        - Arn
    Export:
      Name: CustomEmailSenderKMSKey
  CustomEmailSenderLambda:
    Description: 'Execute following CLI command: aws cognito-idp update-user-pool --user-pool-id INSERT_POOL_ID --lambda-config "CustomEmailSender={LambdaVersion=V1_0,LambdaArn=INSERT_LAMBDA_ARN},KMSKeyID=KMS_KEY_ARN"'
    Value:
      Fn::GetAtt:
        - ApiLoadTestCustomEmailSenderKeyA6F61AB3
        - Arn
    Export:
      Name: CustomEmailSenderLambdaARN
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

Description: 'Serverless API Gateway Load Testing Framework. Run following CLI command after stack is deployed, Execute following CLI command: aws cognito-idp update-user-pool --user-pool-id INSERT_POOL_ID --lambda-config "CustomEmailSender={LambdaVersion=V1_0,LambdaArn=INSERT_LAMBDA_ARN},KMSKeyID=KMS_KEY_ARN"'
Parameters:
  apiGatewayUrl:
    Type: String
    Description: API Gateway URL being load tested.
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D:
    Type: String
    Description: S3 bucket for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962:
    Type: String
    Description: S3 key for asset version "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcArtifactHash4AD90612:
    Type: String
    Description: Artifact hash for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dS3Bucket750B891F:
    Type: String
    Description: S3 bucket for asset "48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87d"
  AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dS3VersionKeyA95D11C4:
    Type: String
    Description: S3 key for asset version "48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87d"
  AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dArtifactHash754521D3:
    Type: String
    Description: Artifact hash for asset "48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87d"
  AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3Bucket65C283B5:
    Type: String
    Description: S3 bucket for asset "a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8"
  AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3VersionKey75DFE7A2:
    Type: String
    Description: S3 key for asset version "a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8"
  AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8ArtifactHash3426DA5A:
    Type: String
    Description: Artifact hash for asset "a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8"
  AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3BucketC1014CE1:
    Type: String
    Description: S3 bucket for asset "9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11"
  AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3VersionKeyFF04957D:
    Type: String
    Description: S3 key for asset version "9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11"
  AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11ArtifactHashEB517A0F:
    Type: String
    Description: Artifact hash for asset "9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11"
  AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3BucketB9F5835B:
    Type: String
    Description: S3 bucket for asset "dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c"
  AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3VersionKeyD80B12BA:
    Type: String
    Description: S3 key for asset version "dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c"
  AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cArtifactHash8FEBF4B9:
    Type: String
    Description: Artifact hash for asset "dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c"
  AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3Bucket1F5C3F3C:
    Type: String
    Description: S3 bucket for asset "adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7"
  AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3VersionKey042EF73F:
    Type: String
    Description: S3 key for asset version "adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7"
  AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7ArtifactHashAF439838:
    Type: String
    Description: Artifact hash for asset "adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7"
  AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3BucketA1CDCDEA:
    Type: String
    Description: S3 bucket for asset "956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6"
  AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3VersionKey75D08C82:
    Type: String
    Description: S3 key for asset version "956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6"
  AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6ArtifactHash04DC176F:
    Type: String
    Description: Artifact hash for asset "956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6"
Resources:
  ApiLoadTestcustomEmailSenderServiceRole13C1ADDB:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/ServiceRole/Resource
  ApiLoadTestcustomEmailSenderA4C16EC1:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
      Role:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
          - Arn
      Handler: index.handler
      Runtime: nodejs12.x
    DependsOn:
      - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/Resource
      aws:asset:path: asset.016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc
      aws:asset:property: Code
  ApiLoadTestcustomEmailSenderInvokeServicePrincipalcognitoidpamazonawscomA9D8E09E:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderA4C16EC1
          - Arn
      Principal: cognito-idp.amazonaws.com
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/InvokeServicePrincipal(cognito-idp.amazonaws.com)
  ApiLoadTestCustomEmailSenderKey57B285AC:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action:
              - kms:Create*
              - kms:Describe*
              - kms:Enable*
              - kms:List*
              - kms:Put*
              - kms:Update*
              - kms:Revoke*
              - kms:Disable*
              - kms:Get*
              - kms:Delete*
              - kms:ScheduleKeyDeletion
              - kms:CancelKeyDeletion
              - kms:GenerateDataKey
              - kms:TagResource
              - kms:UntagResource
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
        Version: "2012-10-17"
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCustomEmailSenderKey/Resource
  ApiLoadTestcognitoUserPool4971E565:
    Type: AWS::Cognito::UserPool
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
          - Name: verified_phone_number
            Priority: 1
          - Name: verified_email
            Priority: 2
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: true
      EmailVerificationMessage: The verification code to your new account is {####}
      EmailVerificationSubject: Verify your new account
      SmsVerificationMessage: The verification code to your new account is {####}
      UserPoolName: loadtestidp
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: The verification code to your new account is {####}
        EmailSubject: Verify your new account
        SmsMessage: The verification code to your new account is {####}
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/Resource
  ApiLoadTestcognitoUserPooltestusers72A7191D:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      UserPoolId:
        Ref: ApiLoadTestcognitoUserPool4971E565
      AllowedOAuthFlows:
        - implicit
        - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
        - profile
        - phone
        - email
        - openid
        - aws.cognito.signin.user.admin
      CallbackURLs:
        - https://example.com
      SupportedIdentityProviders:
        - COGNITO
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/testusers/Resource
  ApiLoadTestcreateTestUserIdsServiceRole58EABEEE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/ServiceRole/Resource
  ApiLoadTestcreateTestUserIds13AAD40B:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dS3Bucket750B891F
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dS3VersionKeyA95D11C4
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87dS3VersionKeyA95D11C4
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
          - Arn
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 3
    DependsOn:
      - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/Resource
      aws:asset:path: asset.48b5eff3209815a82ad2d512ecfe54c5dee9bf0478f07283f7b69624275ad87d
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/ServiceRole/Resource
  ApiLoadTestcleanUpTestUsers0F0048BF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3Bucket65C283B5
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3VersionKey75DFE7A2
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3VersionKey75DFE7A2
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 512
      Runtime: python3.8
      Timeout: 600
    DependsOn:
      - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/Resource
      aws:asset:path: asset.a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8
      aws:asset:property: Code
  ApiLoadTestcreateTestUsersServiceRoleA10AB7A3:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/ServiceRole/Resource
  ApiLoadTestcreateTestUsers2EA4A164:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3BucketC1014CE1
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3VersionKeyFF04957D
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3VersionKeyFF04957D
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 856
      Runtime: python3.8
      Timeout: 900
    DependsOn:
      - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/Resource
      aws:asset:path: asset.9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11
      aws:asset:property: Code
  ApiLoadTesttriggerLoadTestPerUserServiceRole69131892:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/ServiceRole/Resource
  ApiLoadTesttriggerLoadTestPerUser0298BEBF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3BucketB9F5835B
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3VersionKeyD80B12BA
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3VersionKeyD80B12BA
      Role:
        Fn::GetAtt:
          - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
          - Arn
      Environment:
        Variables:
          numberOfCallsPerUser: $.NumberOfCallsPerUser
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
          api_url:
            Ref: apiGatewayUrl
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Runtime: python3.8
      Timeout: 300
    DependsOn:
      - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/Resource
      aws:asset:path: asset.dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUserServiceRole69870DE1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/ServiceRole/Resource
  ApiLoadTestcleanUpTestUser636191B0:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3Bucket1F5C3F3C
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3VersionKey042EF73F
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3VersionKey042EF73F
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUserServiceRole69870DE1
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcleanUpTestUserServiceRole69870DE1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/Resource
      aws:asset:path: asset.adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7
      aws:asset:property: Code
  ApiLoadTestcreateTestUserServiceRoleE9A70E17:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/ServiceRole/Resource
  ApiLoadTestcreateTestUser1165A158:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3BucketA1CDCDEA
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3VersionKey75D08C82
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3VersionKey75D08C82
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserServiceRoleE9A70E17
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcreateTestUserServiceRoleE9A70E17
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/Resource
      aws:asset:path: asset.956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6
      aws:asset:property: Code
  ApiLoadTestCreateUsersAndFanOutRole5A37D1C1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/Resource
  ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      Roles:
        - Ref: ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/DefaultPolicy/Resource
  ApiLoadTestCreateUsersAndFanOut21A1CD41:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"Is Input Valid?","States":{"Is Input Valid?":{"Type":"Choice","Choices":[{"Variable":"$.NumberOfUsers","NumericGreaterThan":1000,"Next":"Input validation failed: NumberOfUsers"},{"Variable":"$.NumberOfCallsPerUser","NumericGreaterThan":1000,"Next":"Input validation failed: NumberOfCallsPerUser"}],"Default":"CreateTestUserIdsTask"},"CreateTestUserIdsTask":{"Next":"CreateTestUsersTask","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","OutputPath":"$.taskResult","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
            - '","Payload.$":"$"}},"CreateTestUsersTask":{"Next":"TriggerLoadTest","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
            - '","Payload.$":"$"}},"TriggerLoadTest":{"Type":"Map","Next":"Complete","Iterator":{"StartAt":"TriggerLoadTestPerUserTask","States":{"TriggerLoadTestPerUserTask":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
            - '","Payload.$":"$"}}}},"ItemsPath":"$.taskResult.userNames","MaxConcurrency":0},"Complete":{"Type":"Pass","End":true},"Input validation failed: NumberOfUsers":{"Type":"Fail","Error":"NumberOfUsers > 1000","Cause":"Input Validation Failed. Please check NumberOfUser"},"Input validation failed: NumberOfCallsPerUser":{"Type":"Fail","Error":"NumberOfCallsPerUser > 1000 ","Cause":"Input Validation Failed. Please check NumberOfCallsPerUser. "}},"TimeoutSeconds":900}'
    DependsOn:
      - ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Resource
  ApiLoadTestDeleteTestUsersRole665E78AE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/Resource
  ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      Roles:
        - Ref: ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/DefaultPolicy/Resource
  ApiLoadTestDeleteTestUsersA4ED05D0:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestDeleteTestUsersRole665E78AE
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"DeleteTestUsersTask","States":{"DeleteTestUsersTask":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
            - '","Payload.$":"$"}}},"TimeoutSeconds":600}'
    DependsOn:
      - ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      - ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=1.87.1,@aws-cdk/assets=1.89.0,@aws-cdk/aws-applicationautoscaling=1.89.0,@aws-cdk/aws-autoscaling=1.89.0,@aws-cdk/aws-autoscaling-common=1.89.0,@aws-cdk/aws-autoscaling-hooktargets=1.89.0,@aws-cdk/aws-cloudwatch=1.89.0,@aws-cdk/aws-codebuild=1.89.0,@aws-cdk/aws-codeguruprofiler=1.89.0,@aws-cdk/aws-cognito=1.89.0,@aws-cdk/aws-ec2=1.89.0,@aws-cdk/aws-ecr=1.89.0,@aws-cdk/aws-ecr-assets=1.89.0,@aws-cdk/aws-ecs=1.89.0,@aws-cdk/aws-elasticloadbalancingv2=1.89.0,@aws-cdk/aws-events=1.89.0,@aws-cdk/aws-iam=1.89.0,@aws-cdk/aws-kms=1.89.0,@aws-cdk/aws-lambda=1.89.0,@aws-cdk/aws-logs=1.89.0,@aws-cdk/aws-s3=1.89.0,@aws-cdk/aws-s3-assets=1.89.0,@aws-cdk/aws-servicediscovery=1.89.0,@aws-cdk/aws-sns=1.89.0,@aws-cdk/aws-sns-subscriptions=1.89.0,@aws-cdk/aws-sqs=1.89.0,@aws-cdk/aws-ssm=1.89.0,@aws-cdk/aws-stepfunctions=1.89.0,@aws-cdk/aws-stepfunctions-tasks=1.89.0,@aws-cdk/cloud-assembly-schema=1.89.0,@aws-cdk/core=1.89.0,@aws-cdk/custom-resources=1.89.0,@aws-cdk/cx-api=1.89.0,@aws-cdk/region-info=1.89.0,jsii-runtime=node.js/v10.23.2
    Metadata:
      aws:cdk:path: aws-apiloadtest/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Outputs:
  UserPoolID:
    Description: User Pool ID
    Value:
      Ref: ApiLoadTestcognitoUserPool4971E565
    Export:
      Name: UserPoolID
  KMSKey:
    Description: CustomEmailSender KMS Key ARN
    Value:
      Fn::GetAtt:
        - ApiLoadTestCustomEmailSenderKey57B285AC
        - Arn
    Export:
      Name: CustomEmailSenderKMSKey
  CustomEmailSenderLambda:
    Description: CustomEmailSender lambda function
    Value:
      Fn::GetAtt:
        - ApiLoadTestcustomEmailSenderA4C16EC1
        - Arn
    Export:
      Name: CustomEmailSenderLambdaARN
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

Description: 'Serverless API Gateway Load Testing Framework. Run following CLI command after stack is deployed, Execute following CLI command: aws cognito-idp update-user-pool --user-pool-id INSERT_POOL_ID --lambda-config "CustomEmailSender={LambdaVersion=V1_0,LambdaArn=INSERT_LAMBDA_ARN},KMSKeyID=KMS_KEY_ARN"'
Parameters:
  apiGatewayUrl:
    Type: String
    Description: API Gateway URL being load tested.
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D:
    Type: String
    Description: S3 bucket for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962:
    Type: String
    Description: S3 key for asset version "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcArtifactHash4AD90612:
    Type: String
    Description: Artifact hash for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF:
    Type: String
    Description: S3 bucket for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65:
    Type: String
    Description: S3 key for asset version "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490ArtifactHashE3B5816E:
    Type: String
    Description: Artifact hash for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3Bucket65C283B5:
    Type: String
    Description: S3 bucket for asset "a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8"
  AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3VersionKey75DFE7A2:
    Type: String
    Description: S3 key for asset version "a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8"
  AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8ArtifactHash3426DA5A:
    Type: String
    Description: Artifact hash for asset "a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8"
  AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3BucketC1014CE1:
    Type: String
    Description: S3 bucket for asset "9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11"
  AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3VersionKeyFF04957D:
    Type: String
    Description: S3 key for asset version "9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11"
  AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11ArtifactHashEB517A0F:
    Type: String
    Description: Artifact hash for asset "9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11"
  AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3BucketB9F5835B:
    Type: String
    Description: S3 bucket for asset "dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c"
  AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3VersionKeyD80B12BA:
    Type: String
    Description: S3 key for asset version "dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c"
  AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cArtifactHash8FEBF4B9:
    Type: String
    Description: Artifact hash for asset "dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c"
  AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3Bucket1F5C3F3C:
    Type: String
    Description: S3 bucket for asset "adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7"
  AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3VersionKey042EF73F:
    Type: String
    Description: S3 key for asset version "adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7"
  AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7ArtifactHashAF439838:
    Type: String
    Description: Artifact hash for asset "adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7"
  AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3BucketA1CDCDEA:
    Type: String
    Description: S3 bucket for asset "956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6"
  AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3VersionKey75D08C82:
    Type: String
    Description: S3 key for asset version "956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6"
  AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6ArtifactHash04DC176F:
    Type: String
    Description: Artifact hash for asset "956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6"
Resources:
  ApiLoadTestcustomEmailSenderServiceRole13C1ADDB:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/ServiceRole/Resource
  ApiLoadTestcustomEmailSenderA4C16EC1:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
      Role:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
          - Arn
      Handler: index.handler
      Runtime: nodejs12.x
    DependsOn:
      - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/Resource
      aws:asset:path: asset.016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc
      aws:asset:property: Code
  ApiLoadTestcustomEmailSenderInvokeServicePrincipalcognitoidpamazonawscomA9D8E09E:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderA4C16EC1
          - Arn
      Principal: cognito-idp.amazonaws.com
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/InvokeServicePrincipal(cognito-idp.amazonaws.com)
  ApiLoadTestCustomEmailSenderKey57B285AC:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action:
              - kms:Create*
              - kms:Describe*
              - kms:Enable*
              - kms:List*
              - kms:Put*
              - kms:Update*
              - kms:Revoke*
              - kms:Disable*
              - kms:Get*
              - kms:Delete*
              - kms:ScheduleKeyDeletion
              - kms:CancelKeyDeletion
              - kms:GenerateDataKey
              - kms:TagResource
              - kms:UntagResource
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
        Version: "2012-10-17"
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCustomEmailSenderKey/Resource
  ApiLoadTestcognitoUserPool4971E565:
    Type: AWS::Cognito::UserPool
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
          - Name: verified_phone_number
            Priority: 1
          - Name: verified_email
            Priority: 2
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: true
      EmailVerificationMessage: The verification code to your new account is {####}
      EmailVerificationSubject: Verify your new account
      SmsVerificationMessage: The verification code to your new account is {####}
      UserPoolName: loadtestidp
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: The verification code to your new account is {####}
        EmailSubject: Verify your new account
        SmsMessage: The verification code to your new account is {####}
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/Resource
  ApiLoadTestcognitoUserPooltestusers72A7191D:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      UserPoolId:
        Ref: ApiLoadTestcognitoUserPool4971E565
      AllowedOAuthFlows:
        - implicit
        - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
        - profile
        - phone
        - email
        - openid
        - aws.cognito.signin.user.admin
      CallbackURLs:
        - https://example.com
      SupportedIdentityProviders:
        - COGNITO
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/testusers/Resource
  ApiLoadTestcreateTestUserIdsServiceRole58EABEEE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/ServiceRole/Resource
  ApiLoadTestcreateTestUserIds13AAD40B:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
          - Arn
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 3
    DependsOn:
      - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/Resource
      aws:asset:path: asset.72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/ServiceRole/Resource
  ApiLoadTestcleanUpTestUsers0F0048BF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3Bucket65C283B5
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3VersionKey75DFE7A2
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersa54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8S3VersionKey75DFE7A2
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 512
      Runtime: python3.8
      Timeout: 600
    DependsOn:
      - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/Resource
      aws:asset:path: asset.a54e835c755cd763c8612d06a1f520c56471e152978cfd706e7559418a3e5bf8
      aws:asset:property: Code
  ApiLoadTestcreateTestUsersServiceRoleA10AB7A3:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/ServiceRole/Resource
  ApiLoadTestcreateTestUsers2EA4A164:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3BucketC1014CE1
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3VersionKeyFF04957D
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11S3VersionKeyFF04957D
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 856
      Runtime: python3.8
      Timeout: 900
    DependsOn:
      - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/Resource
      aws:asset:path: asset.9b44f6b1e3b0dae44869060b2ec65ee35135c23c2854d200df3f47008d632e11
      aws:asset:property: Code
  ApiLoadTesttriggerLoadTestPerUserServiceRole69131892:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/ServiceRole/Resource
  ApiLoadTesttriggerLoadTestPerUser0298BEBF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3BucketB9F5835B
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3VersionKeyD80B12BA
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersdbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45cS3VersionKeyD80B12BA
      Role:
        Fn::GetAtt:
          - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
          - Arn
      Environment:
        Variables:
          numberOfCallsPerUser: $.NumberOfCallsPerUser
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
          api_url:
            Ref: apiGatewayUrl
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Runtime: python3.8
      Timeout: 300
    DependsOn:
      - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/Resource
      aws:asset:path: asset.dbad05c7043b85d0c6d3ea17268b663186deb2612a4aff6c1020cabc01a1c45c
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUserServiceRole69870DE1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/ServiceRole/Resource
  ApiLoadTestcleanUpTestUser636191B0:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3Bucket1F5C3F3C
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3VersionKey042EF73F
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParametersadeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7S3VersionKey042EF73F
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUserServiceRole69870DE1
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcleanUpTestUserServiceRole69870DE1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/Resource
      aws:asset:path: asset.adeeab75020c2da3afbac3c8c6557fc8167c747bad159a5e9a6671f5ed5f91c7
      aws:asset:property: Code
  ApiLoadTestcreateTestUserServiceRoleE9A70E17:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/ServiceRole/Resource
  ApiLoadTestcreateTestUser1165A158:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3BucketA1CDCDEA
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3VersionKey75D08C82
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6S3VersionKey75D08C82
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserServiceRoleE9A70E17
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcreateTestUserServiceRoleE9A70E17
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/Resource
      aws:asset:path: asset.956ce0a4ad067539ca9782e4e0cd2f03dea7f70985dc6a6290041a4c8356a1c6
      aws:asset:property: Code
  ApiLoadTestCreateUsersAndFanOutRole5A37D1C1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/Resource
  ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      Roles:
        - Ref: ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/DefaultPolicy/Resource
  ApiLoadTestCreateUsersAndFanOut21A1CD41:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"Is Input Valid?","States":{"Is Input Valid?":{"Type":"Choice","Choices":[{"Variable":"$.users.NumberOfUsers","NumericGreaterThan":1000,"Next":"Input validation failed: NumberOfUsers"},{"Variable":"$.users.NumberOfCallsPerUser","NumericGreaterThan":1000,"Next":"Input validation failed: NumberOfUsers"}],"Default":"CreateTestUserIds"},"CreateTestUserIds":{"Next":"CreateTestUsers","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","OutputPath":"$.taskResult","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
            - '","Payload.$":"$"}},"CreateTestUsers":{"Next":"LoadTestFanOut","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
            - '","Payload.$":"$"}},"LoadTestFanOut":{"Type":"Map","Next":"TestComplete","Iterator":{"StartAt":"TriggerLoadTest","States":{"TriggerLoadTest":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
            - '","Payload.$":"$"}}}},"ItemsPath":"$.taskResult.userNames","MaxConcurrency":0},"TestComplete":{"Type":"Pass","End":true},"Input validation failed: NumberOfUsers":{"Type":"Fail","Error":"NumberOfUsers > 1000 OR NumberOfCallsPerUser > 1000","Cause":"Input Validation Failed. Please ensure NumberOfUser & NumberOfCallsPerUser do not exceed limits."}},"TimeoutSeconds":900}'
    DependsOn:
      - ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Resource
  ApiLoadTestDeleteTestUsersRole665E78AE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/Resource
  ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      Roles:
        - Ref: ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/DefaultPolicy/Resource
  ApiLoadTestDeleteTestUsersA4ED05D0:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestDeleteTestUsersRole665E78AE
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"DeleteTestUsersTask","States":{"DeleteTestUsersTask":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
            - '","Payload.$":"$"}}},"TimeoutSeconds":600}'
    DependsOn:
      - ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      - ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=1.87.1,@aws-cdk/assets=1.89.0,@aws-cdk/aws-applicationautoscaling=1.89.0,@aws-cdk/aws-autoscaling=1.89.0,@aws-cdk/aws-autoscaling-common=1.89.0,@aws-cdk/aws-autoscaling-hooktargets=1.89.0,@aws-cdk/aws-cloudwatch=1.89.0,@aws-cdk/aws-codebuild=1.89.0,@aws-cdk/aws-codeguruprofiler=1.89.0,@aws-cdk/aws-cognito=1.89.0,@aws-cdk/aws-ec2=1.89.0,@aws-cdk/aws-ecr=1.89.0,@aws-cdk/aws-ecr-assets=1.89.0,@aws-cdk/aws-ecs=1.89.0,@aws-cdk/aws-elasticloadbalancingv2=1.89.0,@aws-cdk/aws-events=1.89.0,@aws-cdk/aws-iam=1.89.0,@aws-cdk/aws-kms=1.89.0,@aws-cdk/aws-lambda=1.89.0,@aws-cdk/aws-logs=1.89.0,@aws-cdk/aws-s3=1.89.0,@aws-cdk/aws-s3-assets=1.89.0,@aws-cdk/aws-servicediscovery=1.89.0,@aws-cdk/aws-sns=1.89.0,@aws-cdk/aws-sns-subscriptions=1.89.0,@aws-cdk/aws-sqs=1.89.0,@aws-cdk/aws-ssm=1.89.0,@aws-cdk/aws-stepfunctions=1.89.0,@aws-cdk/aws-stepfunctions-tasks=1.89.0,@aws-cdk/cloud-assembly-schema=1.89.0,@aws-cdk/core=1.89.0,@aws-cdk/custom-resources=1.89.0,@aws-cdk/cx-api=1.89.0,@aws-cdk/region-info=1.89.0,jsii-runtime=node.js/v10.23.2
    Metadata:
      aws:cdk:path: aws-apiloadtest/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Outputs:
  UserPoolID:
    Description: User Pool ID
    Value:
      Ref: ApiLoadTestcognitoUserPool4971E565
    Export:
      Name: UserPoolID
  KMSKey:
    Description: CustomEmailSender KMS Key ARN
    Value:
      Fn::GetAtt:
        - ApiLoadTestCustomEmailSenderKey57B285AC
        - Arn
    Export:
      Name: CustomEmailSenderKMSKey
  CustomEmailSenderLambda:
    Description: CustomEmailSender lambda function
    Value:
      Fn::GetAtt:
        - ApiLoadTestcustomEmailSenderA4C16EC1
        - Arn
    Export:
      Name: CustomEmailSenderLambdaARN
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

Description: 'Serverless API Gateway Load Testing Framework. Run following CLI command after stack is deployed, Execute following CLI command: aws cognito-idp update-user-pool --user-pool-id INSERT_POOL_ID --lambda-config "CustomEmailSender={LambdaVersion=V1_0,LambdaArn=INSERT_LAMBDA_ARN},KMSKeyID=KMS_KEY_ARN"'
Parameters:
  apiGatewayUrl:
    Type: String
    Description: API Gateway URL being load tested.
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D:
    Type: String
    Description: S3 bucket for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962:
    Type: String
    Description: S3 key for asset version "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcArtifactHash4AD90612:
    Type: String
    Description: Artifact hash for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF:
    Type: String
    Description: S3 bucket for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65:
    Type: String
    Description: S3 key for asset version "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490ArtifactHashE3B5816E:
    Type: String
    Description: Artifact hash for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters8e01f9bb6089056b0cd6fee9677ef44265eb5d3d859ca859c64f2a12969f406eS3Bucket5258E5FA:
    Type: String
    Description: S3 bucket for asset "8e01f9bb6089056b0cd6fee9677ef44265eb5d3d859ca859c64f2a12969f406e"
  AssetParameters8e01f9bb6089056b0cd6fee9677ef44265eb5d3d859ca859c64f2a12969f406eS3VersionKey608F0B65:
    Type: String
    Description: S3 key for asset version "8e01f9bb6089056b0cd6fee9677ef44265eb5d3d859ca859c64f2a12969f406e"
  AssetParameters8e01f9bb6089056b0cd6fee9677ef44265eb5d3d859ca859c64f2a12969f406eArtifactHash6895F4E3:
    Type: String
    Description: Artifact hash for asset "8e01f9bb6089056b0cd6fee9677ef44265eb5d3d859ca859c64f2a12969f406e"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3Bucket3E98B32F:
    Type: String
    Description: S3 bucket for asset "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B:
    Type: String
    Description: S3 key for asset version "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52ArtifactHash6BD602EB:
    Type: String
    Description: Artifact hash for asset "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3Bucket77B37C56:
    Type: String
    Description: S3 bucket for asset "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0:
    Type: String
    Description: S3 key for asset version "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671ArtifactHashEE92A403:
    Type: String
    Description: Artifact hash for asset "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3Bucket2D672177:
    Type: String
    Description: S3 bucket for asset "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6:
    Type: String
    Description: S3 key for asset version "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cArtifactHash8683175F:
    Type: String
    Description: Artifact hash for asset "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3Bucket02C90976:
    Type: String
    Description: S3 bucket for asset "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0:
    Type: String
    Description: S3 key for asset version "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eArtifactHash69B58EDC:
    Type: String
    Description: Artifact hash for asset "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
Resources:
  ApiLoadTestcustomEmailSenderServiceRole13C1ADDB:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/ServiceRole/Resource
  ApiLoadTestcustomEmailSenderA4C16EC1:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
      Role:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
          - Arn
      Handler: index.handler
      Runtime: nodejs12.x
    DependsOn:
      - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/Resource
      aws:asset:path: asset.016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc
      aws:asset:property: Code
  ApiLoadTestcustomEmailSenderInvokeServicePrincipalcognitoidpamazonawscomA9D8E09E:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderA4C16EC1
          - Arn
      Principal: cognito-idp.amazonaws.com
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/InvokeServicePrincipal(cognito-idp.amazonaws.com)
  ApiLoadTestCustomEmailSenderKey57B285AC:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action:
              - kms:Create*
              - kms:Describe*
              - kms:Enable*
              - kms:List*
              - kms:Put*
              - kms:Update*
              - kms:Revoke*
              - kms:Disable*
              - kms:Get*
              - kms:Delete*
              - kms:ScheduleKeyDeletion
              - kms:CancelKeyDeletion
              - kms:GenerateDataKey
              - kms:TagResource
              - kms:UntagResource
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
        Version: "2012-10-17"
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCustomEmailSenderKey/Resource
  ApiLoadTestcognitoUserPool4971E565:
    Type: AWS::Cognito::UserPool
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
          - Name: verified_phone_number
            Priority: 1
          - Name: verified_email
            Priority: 2
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: true
      EmailVerificationMessage: The verification code to your new account is {####}
      EmailVerificationSubject: Verify your new account
      SmsVerificationMessage: The verification code to your new account is {####}
      UserPoolName: loadtestidp
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: The verification code to your new account is {####}
        EmailSubject: Verify your new account
        SmsMessage: The verification code to your new account is {####}
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/Resource
  ApiLoadTestcognitoUserPooltestusers72A7191D:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      UserPoolId:
        Ref: ApiLoadTestcognitoUserPool4971E565
      AllowedOAuthFlows:
        - implicit
        - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
        - profile
        - phone
        - email
        - openid
        - aws.cognito.signin.user.admin
      CallbackURLs:
        - https://example.com
      SupportedIdentityProviders:
        - COGNITO
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/testusers/Resource
  ApiLoadTestcreateTestUserIdsServiceRole58EABEEE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/ServiceRole/Resource
  ApiLoadTestcreateTestUserIds13AAD40B:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
          - Arn
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 3
    DependsOn:
      - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/Resource
      aws:asset:path: asset.72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/ServiceRole/Resource
  ApiLoadTestcleanUpTestUsers0F0048BF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters8e01f9bb6089056b0cd6fee9677ef44265eb5d3d859ca859c64f2a12969f406eS3Bucket5258E5FA
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters8e01f9bb6089056b0cd6fee9677ef44265eb5d3d859ca859c64f2a12969f406eS3VersionKey608F0B65
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters8e01f9bb6089056b0cd6fee9677ef44265eb5d3d859ca859c64f2a12969f406eS3VersionKey608F0B65
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 512
      Runtime: python3.8
      Timeout: 600
    DependsOn:
      - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/Resource
      aws:asset:path: asset.8e01f9bb6089056b0cd6fee9677ef44265eb5d3d859ca859c64f2a12969f406e
      aws:asset:property: Code
  ApiLoadTestcreateTestUsersServiceRoleA10AB7A3:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/ServiceRole/Resource
  ApiLoadTestcreateTestUsersServiceRoleDefaultPolicyE1433FAD:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - secretsmanager:GetSecretValue
              - secretsmanager:GetRandomPassword
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: ApiLoadTestcreateTestUsersServiceRoleDefaultPolicyE1433FAD
      Roles:
        - Ref: ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/ServiceRole/DefaultPolicy/Resource
  ApiLoadTestcreateTestUsers2EA4A164:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3Bucket3E98B32F
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 856
      Runtime: python3.8
      Timeout: 900
    DependsOn:
      - ApiLoadTestcreateTestUsersServiceRoleDefaultPolicyE1433FAD
      - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/Resource
      aws:asset:path: asset.176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52
      aws:asset:property: Code
  ApiLoadTesttriggerLoadTestPerUserServiceRole69131892:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/ServiceRole/Resource
  ApiLoadTesttriggerLoadTestPerUser0298BEBF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3Bucket77B37C56
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0
      Role:
        Fn::GetAtt:
          - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
          - Arn
      Environment:
        Variables:
          numberOfCallsPerUser: $.NumberOfCallsPerUser
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
          api_url:
            Ref: apiGatewayUrl
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Runtime: python3.8
      Timeout: 300
    DependsOn:
      - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/Resource
      aws:asset:path: asset.21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUserServiceRole69870DE1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/ServiceRole/Resource
  ApiLoadTestcleanUpTestUser636191B0:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3Bucket2D672177
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUserServiceRole69870DE1
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcleanUpTestUserServiceRole69870DE1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/Resource
      aws:asset:path: asset.46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c
      aws:asset:property: Code
  ApiLoadTestcreateTestUserServiceRoleE9A70E17:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/ServiceRole/Resource
  ApiLoadTestcreateTestUser1165A158:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3Bucket02C90976
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserServiceRoleE9A70E17
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcreateTestUserServiceRoleE9A70E17
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/Resource
      aws:asset:path: asset.9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e
      aws:asset:property: Code
  CreateUsersAndFanOutLogGroup6400DA5F:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 731
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/CreateUsersAndFanOutLogGroup/Resource
  ApiLoadTestCreateUsersAndFanOutRole5A37D1C1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/Resource
  ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogDelivery
              - logs:GetLogDelivery
              - logs:UpdateLogDelivery
              - logs:DeleteLogDelivery
              - logs:ListLogDeliveries
              - logs:PutResourcePolicy
              - logs:DescribeResourcePolicies
              - logs:DescribeLogGroups
            Effect: Allow
            Resource: "*"
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      Roles:
        - Ref: ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/DefaultPolicy/Resource
  ApiLoadTestCreateUsersAndFanOut21A1CD41:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"Is Input Valid?","States":{"Is Input Valid?":{"Type":"Choice","Choices":[{"Variable":"$.users.NumberOfUsers","NumericGreaterThan":1000,"Next":"Input validation failed"},{"Variable":"$.users.NumberOfCallsPerUser","NumericGreaterThan":1000,"Next":"Input validation failed"}],"Default":"CreateTestUserIds"},"CreateTestUserIds":{"Next":"CreateTestUsers","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","OutputPath":"$.taskResult","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
            - '","Payload.$":"$"}},"CreateTestUsers":{"Next":"LoadTestFanOut","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
            - '","Payload.$":"$"}},"LoadTestFanOut":{"Type":"Map","Next":"TestComplete","Iterator":{"StartAt":"TriggerLoadTest","States":{"TriggerLoadTest":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
            - '","Payload.$":"$"}}}},"ItemsPath":"$.taskResult.userNames","MaxConcurrency":0},"TestComplete":{"Type":"Pass","End":true},"Input validation failed":{"Type":"Fail","Error":"NumberOfUsers > 1000 OR NumberOfCallsPerUser > 1000","Cause":"Input Validation Failed. Please ensure NumberOfUser & NumberOfCallsPerUser do not exceed limits."}},"TimeoutSeconds":900}'
      LoggingConfiguration:
        Destinations:
          - CloudWatchLogsLogGroup:
              LogGroupArn:
                Fn::GetAtt:
                  - CreateUsersAndFanOutLogGroup6400DA5F
                  - Arn
        Level: ALL
    DependsOn:
      - ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Resource
  DeleteUsersLogGroupA7C6340C:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 731
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/DeleteUsersLogGroup/Resource
  ApiLoadTestDeleteTestUsersRole665E78AE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/Resource
  ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogDelivery
              - logs:GetLogDelivery
              - logs:UpdateLogDelivery
              - logs:DeleteLogDelivery
              - logs:ListLogDeliveries
              - logs:PutResourcePolicy
              - logs:DescribeResourcePolicies
              - logs:DescribeLogGroups
            Effect: Allow
            Resource: "*"
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      Roles:
        - Ref: ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/DefaultPolicy/Resource
  ApiLoadTestDeleteTestUsersA4ED05D0:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestDeleteTestUsersRole665E78AE
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"DeleteTestUsersTask","States":{"DeleteTestUsersTask":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
            - '","Payload.$":"$"}}},"TimeoutSeconds":600}'
      LoggingConfiguration:
        Destinations:
          - CloudWatchLogsLogGroup:
              LogGroupArn:
                Fn::GetAtt:
                  - DeleteUsersLogGroupA7C6340C
                  - Arn
        Level: ALL
    DependsOn:
      - ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      - ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=1.87.1,@aws-cdk/assets=1.89.0,@aws-cdk/aws-applicationautoscaling=1.89.0,@aws-cdk/aws-autoscaling=1.89.0,@aws-cdk/aws-autoscaling-common=1.89.0,@aws-cdk/aws-autoscaling-hooktargets=1.89.0,@aws-cdk/aws-cloudwatch=1.89.0,@aws-cdk/aws-codebuild=1.89.0,@aws-cdk/aws-codeguruprofiler=1.89.0,@aws-cdk/aws-cognito=1.89.0,@aws-cdk/aws-ec2=1.89.0,@aws-cdk/aws-ecr=1.89.0,@aws-cdk/aws-ecr-assets=1.89.0,@aws-cdk/aws-ecs=1.89.0,@aws-cdk/aws-elasticloadbalancingv2=1.89.0,@aws-cdk/aws-events=1.89.0,@aws-cdk/aws-iam=1.89.0,@aws-cdk/aws-kms=1.89.0,@aws-cdk/aws-lambda=1.89.0,@aws-cdk/aws-logs=1.89.0,@aws-cdk/aws-s3=1.89.0,@aws-cdk/aws-s3-assets=1.89.0,@aws-cdk/aws-servicediscovery=1.89.0,@aws-cdk/aws-sns=1.89.0,@aws-cdk/aws-sns-subscriptions=1.89.0,@aws-cdk/aws-sqs=1.89.0,@aws-cdk/aws-ssm=1.89.0,@aws-cdk/aws-stepfunctions=1.89.0,@aws-cdk/aws-stepfunctions-tasks=1.89.0,@aws-cdk/cloud-assembly-schema=1.89.0,@aws-cdk/core=1.89.0,@aws-cdk/custom-resources=1.89.0,@aws-cdk/cx-api=1.89.0,@aws-cdk/region-info=1.89.0,jsii-runtime=node.js/v10.23.2
    Metadata:
      aws:cdk:path: aws-apiloadtest/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Outputs:
  UserPoolID:
    Description: User Pool ID
    Value:
      Ref: ApiLoadTestcognitoUserPool4971E565
    Export:
      Name: UserPoolID
  KMSKey:
    Description: CustomEmailSender KMS Key ARN
    Value:
      Fn::GetAtt:
        - ApiLoadTestCustomEmailSenderKey57B285AC
        - Arn
    Export:
      Name: CustomEmailSenderKMSKey
  CustomEmailSenderLambda:
    Description: CustomEmailSender lambda function
    Value:
      Fn::GetAtt:
        - ApiLoadTestcustomEmailSenderA4C16EC1
        - Arn
    Export:
      Name: CustomEmailSenderLambdaARN
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

Description: 'Serverless API Gateway Load Testing Framework. Run following CLI command after stack is deployed, Execute following CLI command: aws cognito-idp update-user-pool --user-pool-id INSERT_POOL_ID --lambda-config "CustomEmailSender={LambdaVersion=V1_0,LambdaArn=INSERT_LAMBDA_ARN},KMSKeyID=KMS_KEY_ARN"'
Parameters:
  apiGatewayUrl:
    Type: String
    Description: API Gateway URL being load tested.
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D:
    Type: String
    Description: S3 bucket for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962:
    Type: String
    Description: S3 key for asset version "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcArtifactHash4AD90612:
    Type: String
    Description: Artifact hash for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF:
    Type: String
    Description: S3 bucket for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65:
    Type: String
    Description: S3 key for asset version "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490ArtifactHashE3B5816E:
    Type: String
    Description: Artifact hash for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3Bucket7080263A:
    Type: String
    Description: S3 bucket for asset "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7:
    Type: String
    Description: S3 key for asset version "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eArtifactHashEC9B74D6:
    Type: String
    Description: Artifact hash for asset "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3Bucket3E98B32F:
    Type: String
    Description: S3 bucket for asset "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B:
    Type: String
    Description: S3 key for asset version "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52ArtifactHash6BD602EB:
    Type: String
    Description: Artifact hash for asset "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3Bucket77B37C56:
    Type: String
    Description: S3 bucket for asset "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0:
    Type: String
    Description: S3 key for asset version "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671ArtifactHashEE92A403:
    Type: String
    Description: Artifact hash for asset "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3Bucket2D672177:
    Type: String
    Description: S3 bucket for asset "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6:
    Type: String
    Description: S3 key for asset version "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cArtifactHash8683175F:
    Type: String
    Description: Artifact hash for asset "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3Bucket02C90976:
    Type: String
    Description: S3 bucket for asset "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0:
    Type: String
    Description: S3 key for asset version "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eArtifactHash69B58EDC:
    Type: String
    Description: Artifact hash for asset "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
Resources:
  ApiLoadTestcustomEmailSenderServiceRole13C1ADDB:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/ServiceRole/Resource
  ApiLoadTestcustomEmailSenderA4C16EC1:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
      Role:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
          - Arn
      Handler: index.handler
      Runtime: nodejs12.x
    DependsOn:
      - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/Resource
      aws:asset:path: asset.016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc
      aws:asset:property: Code
  ApiLoadTestcustomEmailSenderInvokeServicePrincipalcognitoidpamazonawscomA9D8E09E:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderA4C16EC1
          - Arn
      Principal: cognito-idp.amazonaws.com
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/InvokeServicePrincipal(cognito-idp.amazonaws.com)
  ApiLoadTestCustomEmailSenderKey57B285AC:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action:
              - kms:Create*
              - kms:Describe*
              - kms:Enable*
              - kms:List*
              - kms:Put*
              - kms:Update*
              - kms:Revoke*
              - kms:Disable*
              - kms:Get*
              - kms:Delete*
              - kms:ScheduleKeyDeletion
              - kms:CancelKeyDeletion
              - kms:GenerateDataKey
              - kms:TagResource
              - kms:UntagResource
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
        Version: "2012-10-17"
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCustomEmailSenderKey/Resource
  ApiLoadTestcognitoUserPool4971E565:
    Type: AWS::Cognito::UserPool
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
          - Name: verified_phone_number
            Priority: 1
          - Name: verified_email
            Priority: 2
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: true
      EmailVerificationMessage: The verification code to your new account is {####}
      EmailVerificationSubject: Verify your new account
      SmsVerificationMessage: The verification code to your new account is {####}
      UserPoolName: loadtestidp
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: The verification code to your new account is {####}
        EmailSubject: Verify your new account
        SmsMessage: The verification code to your new account is {####}
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/Resource
  ApiLoadTestcognitoUserPooltestusers72A7191D:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      UserPoolId:
        Ref: ApiLoadTestcognitoUserPool4971E565
      AllowedOAuthFlows:
        - implicit
        - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
        - profile
        - phone
        - email
        - openid
        - aws.cognito.signin.user.admin
      CallbackURLs:
        - https://example.com
      SupportedIdentityProviders:
        - COGNITO
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/testusers/Resource
  ApiLoadTestcreateTestUserIdsServiceRole58EABEEE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/ServiceRole/Resource
  ApiLoadTestcreateTestUserIds13AAD40B:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
          - Arn
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 3
    DependsOn:
      - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/Resource
      aws:asset:path: asset.72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/ServiceRole/Resource
  ApiLoadTestcleanUpTestUsersServiceRoleDefaultPolicy51685291:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - secretsmanager:GetSecretValue
              - secretsmanager:DeleteSecret
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: ApiLoadTestcleanUpTestUsersServiceRoleDefaultPolicy51685291
      Roles:
        - Ref: ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/ServiceRole/DefaultPolicy/Resource
  ApiLoadTestcleanUpTestUsers0F0048BF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3Bucket7080263A
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 512
      Runtime: python3.8
      Timeout: 600
    DependsOn:
      - ApiLoadTestcleanUpTestUsersServiceRoleDefaultPolicy51685291
      - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/Resource
      aws:asset:path: asset.436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e
      aws:asset:property: Code
  ApiLoadTestcreateTestUsersServiceRoleA10AB7A3:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/ServiceRole/Resource
  ApiLoadTestcreateTestUsersServiceRoleDefaultPolicyE1433FAD:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - secretsmanager:GetSecretValue
              - secretsmanager:GetRandomPassword
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: ApiLoadTestcreateTestUsersServiceRoleDefaultPolicyE1433FAD
      Roles:
        - Ref: ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/ServiceRole/DefaultPolicy/Resource
  ApiLoadTestcreateTestUsers2EA4A164:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3Bucket3E98B32F
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 856
      Runtime: python3.8
      Timeout: 900
    DependsOn:
      - ApiLoadTestcreateTestUsersServiceRoleDefaultPolicyE1433FAD
      - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/Resource
      aws:asset:path: asset.176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52
      aws:asset:property: Code
  ApiLoadTesttriggerLoadTestPerUserServiceRole69131892:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/ServiceRole/Resource
  ApiLoadTesttriggerLoadTestPerUserServiceRoleDefaultPolicy8E80FB2D:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: secretsmanager:GetSecretValue
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: ApiLoadTesttriggerLoadTestPerUserServiceRoleDefaultPolicy8E80FB2D
      Roles:
        - Ref: ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/ServiceRole/DefaultPolicy/Resource
  ApiLoadTesttriggerLoadTestPerUser0298BEBF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3Bucket77B37C56
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0
      Role:
        Fn::GetAtt:
          - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
          - Arn
      Environment:
        Variables:
          numberOfCallsPerUser: $.NumberOfCallsPerUser
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
          api_url:
            Ref: apiGatewayUrl
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Runtime: python3.8
      Timeout: 300
    DependsOn:
      - ApiLoadTesttriggerLoadTestPerUserServiceRoleDefaultPolicy8E80FB2D
      - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/Resource
      aws:asset:path: asset.21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUserServiceRole69870DE1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/ServiceRole/Resource
  ApiLoadTestcleanUpTestUser636191B0:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3Bucket2D672177
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUserServiceRole69870DE1
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcleanUpTestUserServiceRole69870DE1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/Resource
      aws:asset:path: asset.46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c
      aws:asset:property: Code
  ApiLoadTestcreateTestUserServiceRoleE9A70E17:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/ServiceRole/Resource
  ApiLoadTestcreateTestUser1165A158:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3Bucket02C90976
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserServiceRoleE9A70E17
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcreateTestUserServiceRoleE9A70E17
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/Resource
      aws:asset:path: asset.9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e
      aws:asset:property: Code
  CreateUsersAndFanOutLogGroup6400DA5F:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 731
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/CreateUsersAndFanOutLogGroup/Resource
  ApiLoadTestCreateUsersAndFanOutRole5A37D1C1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/Resource
  ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogDelivery
              - logs:GetLogDelivery
              - logs:UpdateLogDelivery
              - logs:DeleteLogDelivery
              - logs:ListLogDeliveries
              - logs:PutResourcePolicy
              - logs:DescribeResourcePolicies
              - logs:DescribeLogGroups
            Effect: Allow
            Resource: "*"
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      Roles:
        - Ref: ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/DefaultPolicy/Resource
  ApiLoadTestCreateUsersAndFanOut21A1CD41:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"Is Input Valid?","States":{"Is Input Valid?":{"Type":"Choice","Choices":[{"Variable":"$.users.NumberOfUsers","NumericGreaterThan":1000,"Next":"Input validation failed"},{"Variable":"$.users.NumberOfCallsPerUser","NumericGreaterThan":1000,"Next":"Input validation failed"}],"Default":"CreateTestUserIds"},"CreateTestUserIds":{"Next":"CreateTestUsers","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","OutputPath":"$.taskResult","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
            - '","Payload.$":"$"}},"CreateTestUsers":{"Next":"LoadTestFanOut","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
            - '","Payload.$":"$"}},"LoadTestFanOut":{"Type":"Map","Next":"TestComplete","Iterator":{"StartAt":"TriggerLoadTest","States":{"TriggerLoadTest":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
            - '","Payload.$":"$"}}}},"ItemsPath":"$.taskResult.userNames","MaxConcurrency":0},"TestComplete":{"Type":"Pass","End":true},"Input validation failed":{"Type":"Fail","Error":"NumberOfUsers > 1000 OR NumberOfCallsPerUser > 1000","Cause":"Input Validation Failed. Please ensure NumberOfUser & NumberOfCallsPerUser do not exceed limits."}},"TimeoutSeconds":900}'
      LoggingConfiguration:
        Destinations:
          - CloudWatchLogsLogGroup:
              LogGroupArn:
                Fn::GetAtt:
                  - CreateUsersAndFanOutLogGroup6400DA5F
                  - Arn
        Level: ALL
    DependsOn:
      - ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Resource
  DeleteUsersLogGroupA7C6340C:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 731
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/DeleteUsersLogGroup/Resource
  ApiLoadTestDeleteTestUsersRole665E78AE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/Resource
  ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogDelivery
              - logs:GetLogDelivery
              - logs:UpdateLogDelivery
              - logs:DeleteLogDelivery
              - logs:ListLogDeliveries
              - logs:PutResourcePolicy
              - logs:DescribeResourcePolicies
              - logs:DescribeLogGroups
            Effect: Allow
            Resource: "*"
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      Roles:
        - Ref: ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/DefaultPolicy/Resource
  ApiLoadTestDeleteTestUsersA4ED05D0:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestDeleteTestUsersRole665E78AE
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"DeleteTestUsersTask","States":{"DeleteTestUsersTask":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
            - '","Payload.$":"$"}}},"TimeoutSeconds":600}'
      LoggingConfiguration:
        Destinations:
          - CloudWatchLogsLogGroup:
              LogGroupArn:
                Fn::GetAtt:
                  - DeleteUsersLogGroupA7C6340C
                  - Arn
        Level: ALL
    DependsOn:
      - ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      - ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=1.87.1,@aws-cdk/assets=1.89.0,@aws-cdk/aws-applicationautoscaling=1.89.0,@aws-cdk/aws-autoscaling=1.89.0,@aws-cdk/aws-autoscaling-common=1.89.0,@aws-cdk/aws-autoscaling-hooktargets=1.89.0,@aws-cdk/aws-cloudwatch=1.89.0,@aws-cdk/aws-codebuild=1.89.0,@aws-cdk/aws-codeguruprofiler=1.89.0,@aws-cdk/aws-cognito=1.89.0,@aws-cdk/aws-ec2=1.89.0,@aws-cdk/aws-ecr=1.89.0,@aws-cdk/aws-ecr-assets=1.89.0,@aws-cdk/aws-ecs=1.89.0,@aws-cdk/aws-elasticloadbalancingv2=1.89.0,@aws-cdk/aws-events=1.89.0,@aws-cdk/aws-iam=1.89.0,@aws-cdk/aws-kms=1.89.0,@aws-cdk/aws-lambda=1.89.0,@aws-cdk/aws-logs=1.89.0,@aws-cdk/aws-s3=1.89.0,@aws-cdk/aws-s3-assets=1.89.0,@aws-cdk/aws-servicediscovery=1.89.0,@aws-cdk/aws-sns=1.89.0,@aws-cdk/aws-sns-subscriptions=1.89.0,@aws-cdk/aws-sqs=1.89.0,@aws-cdk/aws-ssm=1.89.0,@aws-cdk/aws-stepfunctions=1.89.0,@aws-cdk/aws-stepfunctions-tasks=1.89.0,@aws-cdk/cloud-assembly-schema=1.89.0,@aws-cdk/core=1.89.0,@aws-cdk/custom-resources=1.89.0,@aws-cdk/cx-api=1.89.0,@aws-cdk/region-info=1.89.0,jsii-runtime=node.js/v10.23.2
    Metadata:
      aws:cdk:path: aws-apiloadtest/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Outputs:
  UserPoolID:
    Description: User Pool ID
    Value:
      Ref: ApiLoadTestcognitoUserPool4971E565
    Export:
      Name: UserPoolID
  KMSKey:
    Description: CustomEmailSender KMS Key ARN
    Value:
      Fn::GetAtt:
        - ApiLoadTestCustomEmailSenderKey57B285AC
        - Arn
    Export:
      Name: CustomEmailSenderKMSKey
  CustomEmailSenderLambda:
    Description: CustomEmailSender lambda function
    Value:
      Fn::GetAtt:
        - ApiLoadTestcustomEmailSenderA4C16EC1
        - Arn
    Export:
      Name: CustomEmailSenderLambdaARN
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

Description: 'Serverless API Gateway Load Testing Framework. Run following CLI command after stack is deployed, Execute following CLI command: aws cognito-idp update-user-pool --user-pool-id INSERT_POOL_ID --lambda-config "CustomEmailSender={LambdaVersion=V1_0,LambdaArn=INSERT_LAMBDA_ARN},KMSKeyID=KMS_KEY_ARN"'
Parameters:
  apiGatewayUrl:
    Type: String
    Description: API Gateway URL being load tested.
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D:
    Type: String
    Description: S3 bucket for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962:
    Type: String
    Description: S3 key for asset version "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcArtifactHash4AD90612:
    Type: String
    Description: Artifact hash for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF:
    Type: String
    Description: S3 bucket for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65:
    Type: String
    Description: S3 key for asset version "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490ArtifactHashE3B5816E:
    Type: String
    Description: Artifact hash for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3Bucket7080263A:
    Type: String
    Description: S3 bucket for asset "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7:
    Type: String
    Description: S3 key for asset version "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eArtifactHashEC9B74D6:
    Type: String
    Description: Artifact hash for asset "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3Bucket3E98B32F:
    Type: String
    Description: S3 bucket for asset "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B:
    Type: String
    Description: S3 key for asset version "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52ArtifactHash6BD602EB:
    Type: String
    Description: Artifact hash for asset "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3Bucket77B37C56:
    Type: String
    Description: S3 bucket for asset "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0:
    Type: String
    Description: S3 key for asset version "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671ArtifactHashEE92A403:
    Type: String
    Description: Artifact hash for asset "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3Bucket2D672177:
    Type: String
    Description: S3 bucket for asset "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6:
    Type: String
    Description: S3 key for asset version "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cArtifactHash8683175F:
    Type: String
    Description: Artifact hash for asset "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3Bucket02C90976:
    Type: String
    Description: S3 bucket for asset "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0:
    Type: String
    Description: S3 key for asset version "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eArtifactHash69B58EDC:
    Type: String
    Description: Artifact hash for asset "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
Resources:
  ApiLoadTestcustomEmailSenderServiceRole13C1ADDB:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/ServiceRole/Resource
  ApiLoadTestcustomEmailSenderA4C16EC1:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
      Role:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
          - Arn
      Handler: index.handler
      Runtime: nodejs12.x
    DependsOn:
      - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/Resource
      aws:asset:path: asset.016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc
      aws:asset:property: Code
  ApiLoadTestcustomEmailSenderInvokeServicePrincipalcognitoidpamazonawscomA9D8E09E:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderA4C16EC1
          - Arn
      Principal: cognito-idp.amazonaws.com
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/InvokeServicePrincipal(cognito-idp.amazonaws.com)
  ApiLoadTestCustomEmailSenderKey57B285AC:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action:
              - kms:Create*
              - kms:Describe*
              - kms:Enable*
              - kms:List*
              - kms:Put*
              - kms:Update*
              - kms:Revoke*
              - kms:Disable*
              - kms:Get*
              - kms:Delete*
              - kms:ScheduleKeyDeletion
              - kms:CancelKeyDeletion
              - kms:GenerateDataKey
              - kms:TagResource
              - kms:UntagResource
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
        Version: "2012-10-17"
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCustomEmailSenderKey/Resource
  ApiLoadTestcognitoUserPool4971E565:
    Type: AWS::Cognito::UserPool
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
          - Name: verified_phone_number
            Priority: 1
          - Name: verified_email
            Priority: 2
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: true
      EmailVerificationMessage: The verification code to your new account is {####}
      EmailVerificationSubject: Verify your new account
      SmsVerificationMessage: The verification code to your new account is {####}
      UserPoolName: loadtestidp
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: The verification code to your new account is {####}
        EmailSubject: Verify your new account
        SmsMessage: The verification code to your new account is {####}
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/Resource
  ApiLoadTestcognitoUserPooltestusers72A7191D:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      UserPoolId:
        Ref: ApiLoadTestcognitoUserPool4971E565
      AllowedOAuthFlows:
        - implicit
        - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
        - profile
        - phone
        - email
        - openid
        - aws.cognito.signin.user.admin
      CallbackURLs:
        - https://example.com
      SupportedIdentityProviders:
        - COGNITO
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/testusers/Resource
  ApiLoadTestcreateTestUserIdsServiceRole58EABEEE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/ServiceRole/Resource
  ApiLoadTestcreateTestUserIds13AAD40B:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
          - Arn
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 3
    DependsOn:
      - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/Resource
      aws:asset:path: asset.72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/SecretsManagerReadWrite
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonCognitoPowerUser
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/ServiceRole/Resource
  ApiLoadTestcleanUpTestUsers0F0048BF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3Bucket7080263A
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 512
      Runtime: python3.8
      Timeout: 600
    DependsOn:
      - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/Resource
      aws:asset:path: asset.436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e
      aws:asset:property: Code
  ApiLoadTestcreateTestUsersServiceRoleA10AB7A3:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/SecretsManagerReadWrite
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonCognitoPowerUser
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/ServiceRole/Resource
  ApiLoadTestcreateTestUsers2EA4A164:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3Bucket3E98B32F
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 856
      Runtime: python3.8
      Timeout: 900
    DependsOn:
      - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/Resource
      aws:asset:path: asset.176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52
      aws:asset:property: Code
  ApiLoadTesttriggerLoadTestPerUserServiceRole69131892:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/SecretsManagerReadWrite
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonCognitoPowerUser
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/ServiceRole/Resource
  ApiLoadTesttriggerLoadTestPerUser0298BEBF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3Bucket77B37C56
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0
      Role:
        Fn::GetAtt:
          - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
          - Arn
      Environment:
        Variables:
          numberOfCallsPerUser: $.NumberOfCallsPerUser
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
          api_url:
            Ref: apiGatewayUrl
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Runtime: python3.8
      Timeout: 300
    DependsOn:
      - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/Resource
      aws:asset:path: asset.21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUserServiceRole69870DE1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/ServiceRole/Resource
  ApiLoadTestcleanUpTestUser636191B0:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3Bucket2D672177
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUserServiceRole69870DE1
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcleanUpTestUserServiceRole69870DE1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/Resource
      aws:asset:path: asset.46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c
      aws:asset:property: Code
  ApiLoadTestcreateTestUserServiceRoleE9A70E17:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/ServiceRole/Resource
  ApiLoadTestcreateTestUser1165A158:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3Bucket02C90976
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserServiceRoleE9A70E17
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcreateTestUserServiceRoleE9A70E17
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/Resource
      aws:asset:path: asset.9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e
      aws:asset:property: Code
  CreateUsersAndFanOutLogGroup6400DA5F:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 731
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/CreateUsersAndFanOutLogGroup/Resource
  ApiLoadTestCreateUsersAndFanOutRole5A37D1C1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/Resource
  ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogDelivery
              - logs:GetLogDelivery
              - logs:UpdateLogDelivery
              - logs:DeleteLogDelivery
              - logs:ListLogDeliveries
              - logs:PutResourcePolicy
              - logs:DescribeResourcePolicies
              - logs:DescribeLogGroups
            Effect: Allow
            Resource: "*"
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      Roles:
        - Ref: ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/DefaultPolicy/Resource
  ApiLoadTestCreateUsersAndFanOut21A1CD41:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"Is Input Valid?","States":{"Is Input Valid?":{"Type":"Choice","Choices":[{"Variable":"$.users.NumberOfUsers","NumericGreaterThan":1000,"Next":"Input validation failed"},{"Variable":"$.users.NumberOfCallsPerUser","NumericGreaterThan":1000,"Next":"Input validation failed"}],"Default":"CreateTestUserIds"},"CreateTestUserIds":{"Next":"CreateTestUsers","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","OutputPath":"$.taskResult","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
            - '","Payload.$":"$"}},"CreateTestUsers":{"Next":"LoadTestFanOut","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
            - '","Payload.$":"$"}},"LoadTestFanOut":{"Type":"Map","Next":"TestComplete","Iterator":{"StartAt":"TriggerLoadTest","States":{"TriggerLoadTest":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
            - '","Payload.$":"$"}}}},"ItemsPath":"$.taskResult.userNames","MaxConcurrency":0},"TestComplete":{"Type":"Pass","End":true},"Input validation failed":{"Type":"Fail","Error":"NumberOfUsers > 1000 OR NumberOfCallsPerUser > 1000","Cause":"Input Validation Failed. Please ensure NumberOfUser & NumberOfCallsPerUser do not exceed limits."}},"TimeoutSeconds":900}'
      LoggingConfiguration:
        Destinations:
          - CloudWatchLogsLogGroup:
              LogGroupArn:
                Fn::GetAtt:
                  - CreateUsersAndFanOutLogGroup6400DA5F
                  - Arn
        Level: ALL
    DependsOn:
      - ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Resource
  DeleteUsersLogGroupA7C6340C:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 731
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/DeleteUsersLogGroup/Resource
  ApiLoadTestDeleteTestUsersRole665E78AE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/Resource
  ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogDelivery
              - logs:GetLogDelivery
              - logs:UpdateLogDelivery
              - logs:DeleteLogDelivery
              - logs:ListLogDeliveries
              - logs:PutResourcePolicy
              - logs:DescribeResourcePolicies
              - logs:DescribeLogGroups
            Effect: Allow
            Resource: "*"
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      Roles:
        - Ref: ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/DefaultPolicy/Resource
  ApiLoadTestDeleteTestUsersA4ED05D0:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestDeleteTestUsersRole665E78AE
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"DeleteTestUsersTask","States":{"DeleteTestUsersTask":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
            - '","Payload.$":"$"}}},"TimeoutSeconds":600}'
      LoggingConfiguration:
        Destinations:
          - CloudWatchLogsLogGroup:
              LogGroupArn:
                Fn::GetAtt:
                  - DeleteUsersLogGroupA7C6340C
                  - Arn
        Level: ALL
    DependsOn:
      - ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      - ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=1.87.1,@aws-cdk/assets=1.89.0,@aws-cdk/aws-applicationautoscaling=1.89.0,@aws-cdk/aws-autoscaling=1.89.0,@aws-cdk/aws-autoscaling-common=1.89.0,@aws-cdk/aws-autoscaling-hooktargets=1.89.0,@aws-cdk/aws-cloudwatch=1.89.0,@aws-cdk/aws-codebuild=1.89.0,@aws-cdk/aws-codeguruprofiler=1.89.0,@aws-cdk/aws-cognito=1.89.0,@aws-cdk/aws-ec2=1.89.0,@aws-cdk/aws-ecr=1.89.0,@aws-cdk/aws-ecr-assets=1.89.0,@aws-cdk/aws-ecs=1.89.0,@aws-cdk/aws-elasticloadbalancingv2=1.89.0,@aws-cdk/aws-events=1.89.0,@aws-cdk/aws-iam=1.89.0,@aws-cdk/aws-kms=1.89.0,@aws-cdk/aws-lambda=1.89.0,@aws-cdk/aws-logs=1.89.0,@aws-cdk/aws-s3=1.89.0,@aws-cdk/aws-s3-assets=1.89.0,@aws-cdk/aws-servicediscovery=1.89.0,@aws-cdk/aws-sns=1.89.0,@aws-cdk/aws-sns-subscriptions=1.89.0,@aws-cdk/aws-sqs=1.89.0,@aws-cdk/aws-ssm=1.89.0,@aws-cdk/aws-stepfunctions=1.89.0,@aws-cdk/aws-stepfunctions-tasks=1.89.0,@aws-cdk/cloud-assembly-schema=1.89.0,@aws-cdk/core=1.89.0,@aws-cdk/custom-resources=1.89.0,@aws-cdk/cx-api=1.89.0,@aws-cdk/region-info=1.89.0,jsii-runtime=node.js/v10.23.2
    Metadata:
      aws:cdk:path: aws-apiloadtest/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Outputs:
  UserPoolID:
    Description: User Pool ID
    Value:
      Ref: ApiLoadTestcognitoUserPool4971E565
    Export:
      Name: UserPoolID
  KMSKey:
    Description: CustomEmailSender KMS Key ARN
    Value:
      Fn::GetAtt:
        - ApiLoadTestCustomEmailSenderKey57B285AC
        - Arn
    Export:
      Name: CustomEmailSenderKMSKey
  CustomEmailSenderLambda:
    Description: CustomEmailSender lambda function
    Value:
      Fn::GetAtt:
        - ApiLoadTestcustomEmailSenderA4C16EC1
        - Arn
    Export:
      Name: CustomEmailSenderLambdaARN
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

Description: 'Serverless API Gateway Load Testing Framework. Run following CLI command after stack is deployed, Execute following CLI command: aws cognito-idp update-user-pool --user-pool-id INSERT_POOL_ID --lambda-config "CustomEmailSender={LambdaVersion=V1_0,LambdaArn=INSERT_LAMBDA_ARN},KMSKeyID=KMS_KEY_ARN"'
Parameters:
  apiGatewayUrl:
    Type: String
    Description: API Gateway URL being load tested.
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D:
    Type: String
    Description: S3 bucket for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962:
    Type: String
    Description: S3 key for asset version "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcArtifactHash4AD90612:
    Type: String
    Description: Artifact hash for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF:
    Type: String
    Description: S3 bucket for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65:
    Type: String
    Description: S3 key for asset version "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490ArtifactHashE3B5816E:
    Type: String
    Description: Artifact hash for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3Bucket7080263A:
    Type: String
    Description: S3 bucket for asset "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7:
    Type: String
    Description: S3 key for asset version "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eArtifactHashEC9B74D6:
    Type: String
    Description: Artifact hash for asset "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3Bucket3E98B32F:
    Type: String
    Description: S3 bucket for asset "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B:
    Type: String
    Description: S3 key for asset version "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52ArtifactHash6BD602EB:
    Type: String
    Description: Artifact hash for asset "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3Bucket77B37C56:
    Type: String
    Description: S3 bucket for asset "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0:
    Type: String
    Description: S3 key for asset version "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671ArtifactHashEE92A403:
    Type: String
    Description: Artifact hash for asset "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3Bucket2D672177:
    Type: String
    Description: S3 bucket for asset "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6:
    Type: String
    Description: S3 key for asset version "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cArtifactHash8683175F:
    Type: String
    Description: Artifact hash for asset "46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3Bucket02C90976:
    Type: String
    Description: S3 bucket for asset "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0:
    Type: String
    Description: S3 key for asset version "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
  AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eArtifactHash69B58EDC:
    Type: String
    Description: Artifact hash for asset "9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e"
Resources:
  ApiLoadTestcustomEmailSenderServiceRole13C1ADDB:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/ServiceRole/Resource
  ApiLoadTestcustomEmailSenderA4C16EC1:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
      Role:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
          - Arn
      Handler: index.handler
      Runtime: nodejs12.x
    DependsOn:
      - ApiLoadTestcustomEmailSenderServiceRole13C1ADDB
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/Resource
      aws:asset:path: asset.016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc
      aws:asset:property: Code
  ApiLoadTestcustomEmailSenderInvokeServicePrincipalcognitoidpamazonawscomA9D8E09E:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderA4C16EC1
          - Arn
      Principal: cognito-idp.amazonaws.com
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcustomEmailSender/InvokeServicePrincipal(cognito-idp.amazonaws.com)
  ApiLoadTestCustomEmailSenderKey57B285AC:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action:
              - kms:Create*
              - kms:Describe*
              - kms:Enable*
              - kms:List*
              - kms:Put*
              - kms:Update*
              - kms:Revoke*
              - kms:Disable*
              - kms:Get*
              - kms:Delete*
              - kms:ScheduleKeyDeletion
              - kms:CancelKeyDeletion
              - kms:GenerateDataKey
              - kms:TagResource
              - kms:UntagResource
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
        Version: "2012-10-17"
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCustomEmailSenderKey/Resource
  ApiLoadTestcognitoUserPool4971E565:
    Type: AWS::Cognito::UserPool
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
          - Name: verified_phone_number
            Priority: 1
          - Name: verified_email
            Priority: 2
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: true
      EmailVerificationMessage: The verification code to your new account is {####}
      EmailVerificationSubject: Verify your new account
      SmsVerificationMessage: The verification code to your new account is {####}
      UserPoolName: loadtestidp
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: The verification code to your new account is {####}
        EmailSubject: Verify your new account
        SmsMessage: The verification code to your new account is {####}
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/Resource
  ApiLoadTestcognitoUserPooltestusers72A7191D:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      UserPoolId:
        Ref: ApiLoadTestcognitoUserPool4971E565
      AllowedOAuthFlows:
        - implicit
        - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
        - profile
        - phone
        - email
        - openid
        - aws.cognito.signin.user.admin
      CallbackURLs:
        - https://example.com
      ExplicitAuthFlows:
        - ALLOW_ADMIN_USER_PASSWORD_AUTH
        - ALLOW_REFRESH_TOKEN_AUTH
      SupportedIdentityProviders:
        - COGNITO
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcognitoUserPool/testusers/Resource
  ApiLoadTestcreateTestUserIdsServiceRole58EABEEE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/ServiceRole/Resource
  ApiLoadTestcreateTestUserIds13AAD40B:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
          - Arn
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 3
    DependsOn:
      - ApiLoadTestcreateTestUserIdsServiceRole58EABEEE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUserIds/Resource
      aws:asset:path: asset.72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/SecretsManagerReadWrite
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonCognitoPowerUser
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/ServiceRole/Resource
  ApiLoadTestcleanUpTestUsers0F0048BF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3Bucket7080263A
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 512
      Runtime: python3.8
      Timeout: 600
    DependsOn:
      - ApiLoadTestcleanUpTestUsersServiceRoleD87A6CF7
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUsers/Resource
      aws:asset:path: asset.436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e
      aws:asset:property: Code
  ApiLoadTestcreateTestUsersServiceRoleA10AB7A3:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/SecretsManagerReadWrite
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonCognitoPowerUser
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/ServiceRole/Resource
  ApiLoadTestcreateTestUsers2EA4A164:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3Bucket3E98B32F
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 856
      Runtime: python3.8
      Timeout: 900
    DependsOn:
      - ApiLoadTestcreateTestUsersServiceRoleA10AB7A3
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUsers/Resource
      aws:asset:path: asset.176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52
      aws:asset:property: Code
  ApiLoadTesttriggerLoadTestPerUserServiceRole69131892:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/SecretsManagerReadWrite
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonCognitoPowerUser
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/ServiceRole/Resource
  ApiLoadTesttriggerLoadTestPerUser0298BEBF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3Bucket77B37C56
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0
      Role:
        Fn::GetAtt:
          - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
          - Arn
      Environment:
        Variables:
          numberOfCallsPerUser: $.NumberOfCallsPerUser
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
          api_url:
            Ref: apiGatewayUrl
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Runtime: python3.8
      Timeout: 300
    DependsOn:
      - ApiLoadTesttriggerLoadTestPerUserServiceRole69131892
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTesttriggerLoadTestPerUser/Resource
      aws:asset:path: asset.21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUserServiceRole69870DE1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/ServiceRole/Resource
  ApiLoadTestcleanUpTestUser636191B0:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3Bucket2D672177
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1cS3VersionKeyB52F5BF6
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUserServiceRole69870DE1
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcleanUpTestUserServiceRole69870DE1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcleanUpTestUser/Resource
      aws:asset:path: asset.46290a1c69f8877f4a8d3ec40bff529417391c05712d3720c1524f6f4a115b1c
      aws:asset:property: Code
  ApiLoadTestcreateTestUserServiceRoleE9A70E17:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/ServiceRole/Resource
  ApiLoadTestcreateTestUser1165A158:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3Bucket02C90976
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5eS3VersionKey2FC0F3F0
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserServiceRoleE9A70E17
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusers72A7191D
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool4971E565
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 10
    DependsOn:
      - ApiLoadTestcreateTestUserServiceRoleE9A70E17
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestcreateTestUser/Resource
      aws:asset:path: asset.9921f90ff35e56dc6dfd22bf918fa37349357bb02a2c7e538d78d4a36af6be5e
      aws:asset:property: Code
  CreateUsersAndFanOutLogGroup6400DA5F:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 731
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/CreateUsersAndFanOutLogGroup/Resource
  ApiLoadTestCreateUsersAndFanOutRole5A37D1C1:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/Resource
  ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogDelivery
              - logs:GetLogDelivery
              - logs:UpdateLogDelivery
              - logs:DeleteLogDelivery
              - logs:ListLogDeliveries
              - logs:PutResourcePolicy
              - logs:DescribeResourcePolicies
              - logs:DescribeLogGroups
            Effect: Allow
            Resource: "*"
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      Roles:
        - Ref: ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Role/DefaultPolicy/Resource
  ApiLoadTestCreateUsersAndFanOut21A1CD41:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"Is Input Valid?","States":{"Is Input Valid?":{"Type":"Choice","Choices":[{"Variable":"$.users.NumberOfUsers","NumericGreaterThan":1000,"Next":"Input validation failed"},{"Variable":"$.users.NumberOfCallsPerUser","NumericGreaterThan":1000,"Next":"Input validation failed"}],"Default":"CreateTestUserIds"},"CreateTestUserIds":{"Next":"CreateTestUsers","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","ResultPath":"$.taskResult","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds13AAD40B
                - Arn
            - '","Payload.$":"$"}},"CreateTestUsers":{"Next":"LoadTestFanOut","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.taskResult.userNames","ResultPath":"$.createResult","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUsers2EA4A164
                - Arn
            - '","Payload.$":"$"}},"LoadTestFanOut":{"Type":"Map","Next":"TestComplete","Iterator":{"StartAt":"TriggerLoadTest","States":{"TriggerLoadTest":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.taskResult.userNames","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUser0298BEBF
                - Arn
            - '","Payload.$":"$"}}}},"MaxConcurrency":0},"TestComplete":{"Type":"Pass","End":true},"Input validation failed":{"Type":"Fail","Error":"NumberOfUsers > 1000 OR NumberOfCallsPerUser > 1000","Cause":"Input Validation Failed. Please ensure NumberOfUser & NumberOfCallsPerUser do not exceed limits."}},"TimeoutSeconds":900}'
      LoggingConfiguration:
        Destinations:
          - CloudWatchLogsLogGroup:
              LogGroupArn:
                Fn::GetAtt:
                  - CreateUsersAndFanOutLogGroup6400DA5F
                  - Arn
        Level: ALL
    DependsOn:
      - ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicyF49A6D48
      - ApiLoadTestCreateUsersAndFanOutRole5A37D1C1
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestCreateUsersAndFanOut/Resource
  CleanUpTaskLogGroup4F0FF4C0:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 731
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/CleanUpTaskLogGroup/Resource
  ApiLoadTestDeleteTestUsersRole665E78AE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/Resource
  ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogDelivery
              - logs:GetLogDelivery
              - logs:UpdateLogDelivery
              - logs:DeleteLogDelivery
              - logs:ListLogDeliveries
              - logs:PutResourcePolicy
              - logs:DescribeResourcePolicies
              - logs:DescribeLogGroups
            Effect: Allow
            Resource: "*"
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      Roles:
        - Ref: ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Role/DefaultPolicy/Resource
  ApiLoadTestDeleteTestUsersA4ED05D0:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestDeleteTestUsersRole665E78AE
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"CleanUpTask","States":{"CleanUpTask":{"Next":"TestCleanUpComplete","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers0F0048BF
                - Arn
            - '","Payload.$":"$"}},"TestCleanUpComplete":{"Type":"Pass","End":true}},"TimeoutSeconds":600}'
      LoggingConfiguration:
        Destinations:
          - CloudWatchLogsLogGroup:
              LogGroupArn:
                Fn::GetAtt:
                  - CleanUpTaskLogGroup4F0FF4C0
                  - Arn
        Level: ALL
    DependsOn:
      - ApiLoadTestDeleteTestUsersRoleDefaultPolicy7A02F236
      - ApiLoadTestDeleteTestUsersRole665E78AE
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTestDeleteTestUsers/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=1.87.1,@aws-cdk/assets=1.89.0,@aws-cdk/aws-applicationautoscaling=1.89.0,@aws-cdk/aws-autoscaling=1.89.0,@aws-cdk/aws-autoscaling-common=1.89.0,@aws-cdk/aws-autoscaling-hooktargets=1.89.0,@aws-cdk/aws-cloudwatch=1.89.0,@aws-cdk/aws-codebuild=1.89.0,@aws-cdk/aws-codeguruprofiler=1.89.0,@aws-cdk/aws-cognito=1.89.0,@aws-cdk/aws-ec2=1.89.0,@aws-cdk/aws-ecr=1.89.0,@aws-cdk/aws-ecr-assets=1.89.0,@aws-cdk/aws-ecs=1.89.0,@aws-cdk/aws-elasticloadbalancingv2=1.89.0,@aws-cdk/aws-events=1.89.0,@aws-cdk/aws-iam=1.89.0,@aws-cdk/aws-kms=1.89.0,@aws-cdk/aws-lambda=1.89.0,@aws-cdk/aws-logs=1.89.0,@aws-cdk/aws-s3=1.89.0,@aws-cdk/aws-s3-assets=1.89.0,@aws-cdk/aws-servicediscovery=1.89.0,@aws-cdk/aws-sns=1.89.0,@aws-cdk/aws-sns-subscriptions=1.89.0,@aws-cdk/aws-sqs=1.89.0,@aws-cdk/aws-ssm=1.89.0,@aws-cdk/aws-stepfunctions=1.89.0,@aws-cdk/aws-stepfunctions-tasks=1.89.0,@aws-cdk/cloud-assembly-schema=1.89.0,@aws-cdk/core=1.89.0,@aws-cdk/custom-resources=1.89.0,@aws-cdk/cx-api=1.89.0,@aws-cdk/region-info=1.89.0,jsii-runtime=node.js/v10.23.2
    Metadata:
      aws:cdk:path: aws-apiloadtest/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Outputs:
  UserPoolID:
    Description: User Pool ID
    Value:
      Ref: ApiLoadTestcognitoUserPool4971E565
    Export:
      Name: UserPoolID
  KMSKey:
    Description: CustomEmailSender KMS Key ARN
    Value:
      Fn::GetAtt:
        - ApiLoadTestCustomEmailSenderKey57B285AC
        - Arn
    Export:
      Name: CustomEmailSenderKMSKey
  CustomEmailSenderLambda:
    Description: CustomEmailSender lambda function
    Value:
      Fn::GetAtt:
        - ApiLoadTestcustomEmailSenderA4C16EC1
        - Arn
    Export:
      Name: CustomEmailSenderLambdaARN
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

Description: 'Serverless API Gateway Load Testing Framework. Run following CLI command after stack is deployed, Execute following CLI command: aws cognito-idp update-user-pool --user-pool-id INSERT_POOL_ID --lambda-config "CustomEmailSender={LambdaVersion=V1_0,LambdaArn=INSERT_LAMBDA_ARN},KMSKeyID=KMS_KEY_ARN"'
Parameters:
  apiGatewayUrl:
    Type: String
    Description: API Gateway URL being load tested.
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D:
    Type: String
    Description: S3 bucket for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962:
    Type: String
    Description: S3 key for asset version "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcArtifactHash4AD90612:
    Type: String
    Description: Artifact hash for asset "016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF:
    Type: String
    Description: S3 bucket for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65:
    Type: String
    Description: S3 key for asset version "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490ArtifactHashE3B5816E:
    Type: String
    Description: Artifact hash for asset "72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3Bucket7080263A:
    Type: String
    Description: S3 bucket for asset "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7:
    Type: String
    Description: S3 key for asset version "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eArtifactHashEC9B74D6:
    Type: String
    Description: Artifact hash for asset "436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3Bucket3E98B32F:
    Type: String
    Description: S3 bucket for asset "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B:
    Type: String
    Description: S3 key for asset version "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52ArtifactHash6BD602EB:
    Type: String
    Description: Artifact hash for asset "176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3Bucket77B37C56:
    Type: String
    Description: S3 bucket for asset "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0:
    Type: String
    Description: S3 key for asset version "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
  AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671ArtifactHashEE92A403:
    Type: String
    Description: Artifact hash for asset "21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671"
Resources:
  ApiLoadTestcustomEmailSenderServiceRole64081F18:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-customEmailSender/ServiceRole/Resource
  ApiLoadTestcustomEmailSenderA2512AF0:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3BucketDBC4B51D
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dcS3VersionKeyDA02F962
      Role:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderServiceRole64081F18
          - Arn
      Handler: index.handler
      Runtime: nodejs12.x
    DependsOn:
      - ApiLoadTestcustomEmailSenderServiceRole64081F18
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-customEmailSender/Resource
      aws:asset:path: asset.016b25817406ac6956e9ff8857a0e12ddf72f2806f239ad2c6db9ff1c0f9b2dc
      aws:asset:property: Code
  ApiLoadTestcustomEmailSenderInvokeServicePrincipalcognitoidpamazonawscom146F3EA2:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - ApiLoadTestcustomEmailSenderA2512AF0
          - Arn
      Principal: cognito-idp.amazonaws.com
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-customEmailSender/InvokeServicePrincipal(cognito-idp.amazonaws.com)
  ApiLoadTestCustomEmailSenderKey3E924B26:
    Type: AWS::KMS::Key
    Properties:
      KeyPolicy:
        Statement:
          - Action:
              - kms:Create*
              - kms:Describe*
              - kms:Enable*
              - kms:List*
              - kms:Put*
              - kms:Update*
              - kms:Revoke*
              - kms:Disable*
              - kms:Get*
              - kms:Delete*
              - kms:ScheduleKeyDeletion
              - kms:CancelKeyDeletion
              - kms:GenerateDataKey
              - kms:TagResource
              - kms:UntagResource
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
        Version: "2012-10-17"
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-CustomEmailSenderKey/Resource
  ApiLoadTestcognitoUserPool1AE0F6E0:
    Type: AWS::Cognito::UserPool
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
          - Name: verified_phone_number
            Priority: 1
          - Name: verified_email
            Priority: 2
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: true
      EmailVerificationMessage: The verification code to your new account is {####}
      EmailVerificationSubject: Verify your new account
      SmsVerificationMessage: The verification code to your new account is {####}
      UserPoolName: ApiLoadTest-loadtestidp
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: The verification code to your new account is {####}
        EmailSubject: Verify your new account
        SmsMessage: The verification code to your new account is {####}
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-cognitoUserPool/Resource
  ApiLoadTestcognitoUserPooltestusersDDA150C4:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      UserPoolId:
        Ref: ApiLoadTestcognitoUserPool1AE0F6E0
      AllowedOAuthFlows:
        - implicit
        - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
        - profile
        - phone
        - email
        - openid
        - aws.cognito.signin.user.admin
      CallbackURLs:
        - https://example.com
      ExplicitAuthFlows:
        - ALLOW_ADMIN_USER_PASSWORD_AUTH
        - ALLOW_REFRESH_TOKEN_AUTH
      SupportedIdentityProviders:
        - COGNITO
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-cognitoUserPool/testusers/Resource
  ApiLoadTestcreateTestUserIdsServiceRoleA48057B0:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-createTestUserIds/ServiceRole/Resource
  ApiLoadTestcreateTestUserIds27908906:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3BucketE8EC52FF
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490S3VersionKey737F2B65
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUserIdsServiceRoleA48057B0
          - Arn
      Handler: lambda_function.lambda_handler
      MemorySize: 128
      Runtime: python3.8
      Timeout: 3
    DependsOn:
      - ApiLoadTestcreateTestUserIdsServiceRoleA48057B0
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-createTestUserIds/Resource
      aws:asset:path: asset.72c9aceac43c217bf4e5f4be7b43e2c89bc409fcde331b843aeee28e251a5490
      aws:asset:property: Code
  ApiLoadTestcleanUpTestUsersServiceRole220CBF49:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/SecretsManagerReadWrite
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonCognitoPowerUser
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-cleanUpTestUsers/ServiceRole/Resource
  ApiLoadTestcleanUpTestUsers5E0BD951:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3Bucket7080263A
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512eS3VersionKeyBC39A8D7
      Role:
        Fn::GetAtt:
          - ApiLoadTestcleanUpTestUsersServiceRole220CBF49
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusersDDA150C4
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool1AE0F6E0
      Handler: lambda_function.lambda_handler
      MemorySize: 512
      Runtime: python3.8
      Timeout: 600
    DependsOn:
      - ApiLoadTestcleanUpTestUsersServiceRole220CBF49
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-cleanUpTestUsers/Resource
      aws:asset:path: asset.436e4d9a93864f5c8a86104cc9cae43eb5d475d6eec1ea3e85d1114458e7512e
      aws:asset:property: Code
  ApiLoadTestcreateTestUsersServiceRoleAEE095BA:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/SecretsManagerReadWrite
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonCognitoPowerUser
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-createTestUsers/ServiceRole/Resource
  ApiLoadTestcreateTestUsers35C9D2AF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3Bucket3E98B32F
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52S3VersionKey471E3E5B
      Role:
        Fn::GetAtt:
          - ApiLoadTestcreateTestUsersServiceRoleAEE095BA
          - Arn
      Environment:
        Variables:
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusersDDA150C4
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool1AE0F6E0
      Handler: lambda_function.lambda_handler
      MemorySize: 856
      Runtime: python3.8
      Timeout: 900
    DependsOn:
      - ApiLoadTestcreateTestUsersServiceRoleAEE095BA
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-createTestUsers/Resource
      aws:asset:path: asset.176db9b0541c764409f045e8367ed32e56634f7de5e01bc75371d6a9abb0db52
      aws:asset:property: Code
  ApiLoadTesttriggerLoadTestPerUserServiceRole4720B364:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/SecretsManagerReadWrite
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonCognitoPowerUser
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-triggerLoadTestPerUser/ServiceRole/Resource
  ApiLoadTesttriggerLoadTestPerUserB8A97FF2:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3Bucket77B37C56
        S3Key:
          Fn::Join:
            - ""
            - - Fn::Select:
                  - 0
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0
              - Fn::Select:
                  - 1
                  - Fn::Split:
                      - "||"
                      - Ref: AssetParameters21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671S3VersionKey501939A0
      Role:
        Fn::GetAtt:
          - ApiLoadTesttriggerLoadTestPerUserServiceRole4720B364
          - Arn
      Environment:
        Variables:
          numberOfCallsPerUser: $.NumberOfCallsPerUser
          client_id:
            Ref: ApiLoadTestcognitoUserPooltestusersDDA150C4
          userpool_id:
            Ref: ApiLoadTestcognitoUserPool1AE0F6E0
          api_url:
            Ref: apiGatewayUrl
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Runtime: python3.8
      Timeout: 300
    DependsOn:
      - ApiLoadTesttriggerLoadTestPerUserServiceRole4720B364
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-triggerLoadTestPerUser/Resource
      aws:asset:path: asset.21808cd0cfa630da037af2ea3766f0ca18a3e5b19d1d45ed0f8270dd5380e671
      aws:asset:property: Code
  CreateUsersAndFanOutLogGroup6400DA5F:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 731
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/CreateUsersAndFanOutLogGroup/Resource
  ApiLoadTestCreateUsersAndFanOutRoleAC20D6C9:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-CreateUsersAndFanOut/Role/Resource
  ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicy4C62D2E6:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogDelivery
              - logs:GetLogDelivery
              - logs:UpdateLogDelivery
              - logs:DeleteLogDelivery
              - logs:ListLogDeliveries
              - logs:PutResourcePolicy
              - logs:DescribeResourcePolicies
              - logs:DescribeLogGroups
            Effect: Allow
            Resource: "*"
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds27908906
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcreateTestUsers35C9D2AF
                - Arn
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUserB8A97FF2
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicy4C62D2E6
      Roles:
        - Ref: ApiLoadTestCreateUsersAndFanOutRoleAC20D6C9
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-CreateUsersAndFanOut/Role/DefaultPolicy/Resource
  ApiLoadTestCreateUsersAndFanOutB93BC081:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestCreateUsersAndFanOutRoleAC20D6C9
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"Is Input Valid?","States":{"Is Input Valid?":{"Type":"Choice","Choices":[{"Variable":"$.users.NumberOfUsers","NumericGreaterThan":1000,"Next":"Input validation failed"},{"Variable":"$.users.NumberOfCallsPerUser","NumericGreaterThan":1000,"Next":"Input validation failed"}],"Default":"CreateTestUserIds"},"CreateTestUserIds":{"Next":"CreateTestUsers","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","ResultPath":"$.taskResult","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUserIds27908906
                - Arn
            - '","Payload.$":"$"}},"CreateTestUsers":{"Next":"LoadTestFanOut","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","InputPath":"$.users","ResultPath":"$.createResult","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcreateTestUsers35C9D2AF
                - Arn
            - '","Payload.$":"$"}},"LoadTestFanOut":{"Type":"Map","Next":"TestComplete","InputPath":"$.taskResult.Payload.userNames","Iterator":{"StartAt":"TriggerLoadTest","States":{"TriggerLoadTest":{"End":true,"Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTesttriggerLoadTestPerUserB8A97FF2
                - Arn
            - '","Payload.$":"$"}}}},"MaxConcurrency":0},"TestComplete":{"Type":"Pass","End":true},"Input validation failed":{"Type":"Fail","Error":"NumberOfUsers > 1000 OR NumberOfCallsPerUser > 1000","Cause":"Input Validation Failed. Please ensure NumberOfUser & NumberOfCallsPerUser do not exceed limits."}},"TimeoutSeconds":900}'
      LoggingConfiguration:
        Destinations:
          - CloudWatchLogsLogGroup:
              LogGroupArn:
                Fn::GetAtt:
                  - CreateUsersAndFanOutLogGroup6400DA5F
                  - Arn
        Level: ALL
    DependsOn:
      - ApiLoadTestCreateUsersAndFanOutRoleDefaultPolicy4C62D2E6
      - ApiLoadTestCreateUsersAndFanOutRoleAC20D6C9
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-CreateUsersAndFanOut/Resource
  CleanUpTaskLogGroup4F0FF4C0:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 731
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: aws-apiloadtest/CleanUpTaskLogGroup/Resource
  ApiLoadTestDeleteTestUsersRole381EAAA7:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                Fn::Join:
                  - ""
                  - - states.
                    - Ref: AWS::Region
                    - .amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-DeleteTestUsers/Role/Resource
  ApiLoadTestDeleteTestUsersRoleDefaultPolicyA7440D02:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:CreateLogDelivery
              - logs:GetLogDelivery
              - logs:UpdateLogDelivery
              - logs:DeleteLogDelivery
              - logs:ListLogDeliveries
              - logs:PutResourcePolicy
              - logs:DescribeResourcePolicies
              - logs:DescribeLogGroups
            Effect: Allow
            Resource: "*"
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers5E0BD951
                - Arn
        Version: "2012-10-17"
      PolicyName: ApiLoadTestDeleteTestUsersRoleDefaultPolicyA7440D02
      Roles:
        - Ref: ApiLoadTestDeleteTestUsersRole381EAAA7
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-DeleteTestUsers/Role/DefaultPolicy/Resource
  ApiLoadTestDeleteTestUsersFE3D334C:
    Type: AWS::StepFunctions::StateMachine
    Properties:
      RoleArn:
        Fn::GetAtt:
          - ApiLoadTestDeleteTestUsersRole381EAAA7
          - Arn
      DefinitionString:
        Fn::Join:
          - ""
          - - '{"StartAt":"CleanUpTask","States":{"CleanUpTask":{"Next":"TestCleanUpComplete","Retry":[{"ErrorEquals":["Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Type":"Task","Resource":"arn:'
            - Ref: AWS::Partition
            - :states:::lambda:invoke","Parameters":{"FunctionName":"
            - Fn::GetAtt:
                - ApiLoadTestcleanUpTestUsers5E0BD951
                - Arn
            - '","Payload.$":"$"}},"TestCleanUpComplete":{"Type":"Pass","End":true}},"TimeoutSeconds":600}'
      LoggingConfiguration:
        Destinations:
          - CloudWatchLogsLogGroup:
              LogGroupArn:
                Fn::GetAtt:
                  - CleanUpTaskLogGroup4F0FF4C0
                  - Arn
        Level: ALL
    DependsOn:
      - ApiLoadTestDeleteTestUsersRoleDefaultPolicyA7440D02
      - ApiLoadTestDeleteTestUsersRole381EAAA7
    Metadata:
      aws:cdk:path: aws-apiloadtest/ApiLoadTest-DeleteTestUsers/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=1.87.1,@aws-cdk/assets=1.89.0,@aws-cdk/aws-applicationautoscaling=1.89.0,@aws-cdk/aws-autoscaling=1.89.0,@aws-cdk/aws-autoscaling-common=1.89.0,@aws-cdk/aws-autoscaling-hooktargets=1.89.0,@aws-cdk/aws-cloudwatch=1.89.0,@aws-cdk/aws-codebuild=1.89.0,@aws-cdk/aws-codeguruprofiler=1.89.0,@aws-cdk/aws-cognito=1.89.0,@aws-cdk/aws-ec2=1.89.0,@aws-cdk/aws-ecr=1.89.0,@aws-cdk/aws-ecr-assets=1.89.0,@aws-cdk/aws-ecs=1.89.0,@aws-cdk/aws-elasticloadbalancingv2=1.89.0,@aws-cdk/aws-events=1.89.0,@aws-cdk/aws-iam=1.89.0,@aws-cdk/aws-kms=1.89.0,@aws-cdk/aws-lambda=1.89.0,@aws-cdk/aws-logs=1.89.0,@aws-cdk/aws-s3=1.89.0,@aws-cdk/aws-s3-assets=1.89.0,@aws-cdk/aws-servicediscovery=1.89.0,@aws-cdk/aws-sns=1.89.0,@aws-cdk/aws-sns-subscriptions=1.89.0,@aws-cdk/aws-sqs=1.89.0,@aws-cdk/aws-ssm=1.89.0,@aws-cdk/aws-stepfunctions=1.89.0,@aws-cdk/aws-stepfunctions-tasks=1.89.0,@aws-cdk/cloud-assembly-schema=1.89.0,@aws-cdk/core=1.89.0,@aws-cdk/custom-resources=1.89.0,@aws-cdk/cx-api=1.89.0,@aws-cdk/region-info=1.89.0,jsii-runtime=node.js/v10.23.2
    Metadata:
      aws:cdk:path: aws-apiloadtest/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Outputs:
  UserPoolID:
    Description: User Pool ID
    Value:
      Ref: ApiLoadTestcognitoUserPool1AE0F6E0
    Export:
      Name: UserPoolID
  KMSKey:
    Description: CustomEmailSender KMS Key ARN
    Value:
      Fn::GetAtt:
        - ApiLoadTestCustomEmailSenderKey3E924B26
        - Arn
    Export:
      Name: CustomEmailSenderKMSKey
  CustomEmailSenderLambda:
    Description: CustomEmailSender lambda function
    Value:
      Fn::GetAtt:
        - ApiLoadTestcustomEmailSenderA2512AF0
        - Arn
    Export:
      Name: CustomEmailSenderLambdaARN
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2

